[{"id":"35db65f2.4e408a","type":"tab","label":"Global Config","disabled":false,"info":"Set all global parameters"},{"id":"42aaf2dc.18badc","type":"tab","label":"Collab- 19 Info Bot","disabled":false,"info":""},{"id":"c578ad64.4c8b1","type":"tab","label":"Contract Wallet Flow","disabled":false,"info":""},{"id":"59ce305.9861dd","type":"tab","label":"(Vote and New Proposal)","disabled":false,"info":""},{"id":"c4310809.e61b28","type":"tab","label":"Noti Listener","disabled":false,"info":""},{"id":"5760092e.43a578","type":"tab","label":"TRF ERC20 Token","disabled":false,"info":""},{"id":"a16cb33.84f085","type":"tab","label":"Group Manager","disabled":false,"info":""},{"id":"d7821d16.12614","type":"tab","label":"Sender Node","disabled":false,"info":""},{"id":"7780ff54.b10e1","type":"tab","label":"Depricated","disabled":false,"info":""},{"id":"cb0dccd6.53ef4","type":"subflow","name":"Block Chain Event Listener","info":"","category":"","in":[{"x":20,"y":80,"wires":[{"id":"21381ef6.1864d2"}]}],"out":[{"x":760,"y":80,"wires":[{"id":"5e0443b8.591b6c","port":0},{"id":"5e0443b8.591b6c","port":1}]}],"env":[],"color":"#DDAA99"},{"id":"1a5b4ace.e30ef5","type":"subflow","name":"Initilise User","info":"","category":"","in":[{"x":40,"y":240,"wires":[{"id":"dc75aefd.0c474"}]}],"out":[{"x":1000,"y":200,"wires":[{"id":"1f781080.8af37","port":0},{"id":"d4047ba.1ccb988","port":1}]},{"x":1000,"y":240,"wires":[{"id":"da0845c.9410bb8","port":1},{"id":"2ded725a.ed761e","port":1}]}],"env":[],"color":"#DDAA99"},{"id":"b49f190.95fa1e8","type":"subflow","name":"Abi Events","info":"","category":"","in":[{"x":420,"y":280,"wires":[{"id":"6a61c0e4.24de2"}]}],"out":[{"x":740,"y":280,"wires":[{"id":"6a61c0e4.24de2","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"cb444aab.0c5578","type":"subflow","name":"Contract Event Listener","info":"","category":"","in":[{"x":180,"y":280,"wires":[{"id":"e4f8fbf8.368898"}]}],"out":[{"x":580,"y":280,"wires":[{"id":"e4f8fbf8.368898","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"7f4d87b0.2a1f88","type":"subflow","name":"Telegram Sender With Tracking","info":"","category":"","in":[{"x":200,"y":280,"wires":[{"id":"580d27ad.d0aa58"}]}],"out":[{"x":780,"y":280,"wires":[{"id":"6330b3c0.27324c","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"e76f3c6.e434dc","type":"subflow","name":"Delete Message","info":"","category":"","in":[{"x":120,"y":180,"wires":[{"id":"97746cdf.85c0d"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"77241988.5609a8","type":"subflow","name":"SDK v2 Helper","info":"","category":"","in":[{"x":320,"y":140,"wires":[{"id":"194f3eb0.85c121"}]}],"out":[{"x":660,"y":140,"wires":[{"id":"194f3eb0.85c121","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"5667a237.c07e7c","type":"subflow","name":"Balance ERC20","info":"","category":"","in":[{"x":360,"y":300,"wires":[{"id":"35b7ca17.270276"}]}],"out":[{"x":780,"y":300,"wires":[{"id":"35b7ca17.270276","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"c5cd3a33.4dfa78","type":"subflow","name":"Get Eth Balance","info":"","category":"","in":[{"x":400,"y":220,"wires":[{"id":"5dfeaeeb.33f7a"}]}],"out":[{"x":700,"y":220,"wires":[{"id":"5dfeaeeb.33f7a","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"6ee374ae.b9327c","type":"subflow","name":"ETH and Token Balance","info":"","category":"","in":[{"x":40,"y":140,"wires":[{"id":"7567445d.05c83c"}]}],"out":[{"x":1100,"y":140,"wires":[{"id":"95a66e94.5a5eb","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"fe8354af.d82c38","type":"subflow","name":"Encode Data","info":"","category":"","in":[{"x":420,"y":240,"wires":[{"id":"d1bafcbf.98a21"}]}],"out":[{"x":720,"y":240,"wires":[{"id":"d1bafcbf.98a21","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"92ad2621.544c88","type":"subflow","name":"kickChatMember","info":"","category":"","in":[{"x":340,"y":320,"wires":[{"id":"71f3ca2f.895194"},{"id":"c5b20d24.a0228"}]}],"out":[{"x":700,"y":320,"wires":[{"id":"71f3ca2f.895194","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"5eb31f33.09c03","type":"subflow","name":"AWS KMS","info":"","category":"","in":[{"x":240,"y":360,"wires":[{"id":"15fb23f7.aecabc"}]}],"out":[{"x":580,"y":360,"wires":[{"id":"15fb23f7.aecabc","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"f7fef601.4cba58","type":"subflow","name":"Decrypt PK","info":"","category":"","in":[{"x":140,"y":320,"wires":[{"id":"f1e1394d.527bb8"}]}],"out":[{"x":1120,"y":320,"wires":[{"id":"f18a2eca.12c98","port":0},{"id":"f1e1394d.527bb8","port":1}]}],"env":[],"color":"#DDAA99"},{"id":"21381ef6.1864d2","type":"function","z":"cb0dccd6.53ef4","name":"BC EventListener","func":"ethers = global.get('ethers');\nlet provider = ethers.getDefaultProvider(msg.payload.network);\n\nlet filter = {\n    address: msg.payload.address\n}\n\nprovider.on(filter, (result) => {\n    msg.payload.transaction = result;\n    node.send(msg);\n});\n\nreturn;","outputs":1,"noerr":0,"x":230,"y":80,"wires":[["a4e7905a.fb6c6"]]},{"id":"a4e7905a.fb6c6","type":"function","z":"cb0dccd6.53ef4","name":"Parse Trx","func":"ethers = global.get('ethers');\nlet provider = ethers.getDefaultProvider(msg.payload.network);\nlet transactionHash = msg.payload.transaction.transactionHash;\n\nif(msg.payload.abi === undefined){\n    node.send(msg);\n    node.done();\n}else{\n    iface = new ethers.utils.Interface (msg.payload.abi);\n    msg.payload.iface = iface;\n    \n    provider.getTransaction(transactionHash).then((transaction) => {\n        transaction.wait(2);\n        msg.payload.trxObj = transaction;\n        init(transaction);\n    });\n}\n\nasync function init(transaction){\n    try{\n      const parsedData = await iface.parseTransaction(transaction) ;\n      msg.payload.parsedData = parsedData;\n    }catch(e){\n        msg.payload.error = e;\n    } \n    node.send(msg);\n    node.done();\n}\n\nreturn ;","outputs":1,"noerr":0,"x":420,"y":80,"wires":[["5e0443b8.591b6c"]]},{"id":"5e0443b8.591b6c","type":"function","z":"cb0dccd6.53ef4","name":"","func":"if(msg.payload.parsedData === null || msg.payload.parsedData === undefined){\n    return [null, msg]\n}\nrecord = {\n    \"event_name\" : msg.payload.parsedData.name, \n    \"from\" : msg.payload.trxObj.from,\n    \"to\" : msg.payload.trxObj.to,\n    \"raw\" : msg.payload.trxObj.raw,\n    \"data\" : msg.payload.trxObj.data,\n    \"hash\" : msg.payload.trxObj.hash\n}\nmsg.payload.record = record;\nreturn [ msg, null ];","outputs":2,"noerr":0,"x":590,"y":80,"wires":[[],[]]},{"id":"fc05e20d.d0932","type":"debug","z":"cb0dccd6.53ef4","name":"BC Event Listener","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":570,"y":220,"wires":[]},{"id":"dc75aefd.0c474","type":"function","z":"1a5b4ace.e30ef5","name":"Get User","func":"msg.payload.filter = `({user_id} = '${msg.payload.userId.toString()}')`;\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":240,"wires":[["da0845c.9410bb8"]]},{"id":"da0845c.9410bb8","type":"node-airtable","z":"1a5b4ace.e30ef5","name":"Get User","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"list","filter":"payload.filter","filterType":"msg","record":"payload","recordType":"msg","records":"","recordsType":"msg","output":"payload.result","x":380,"y":240,"wires":[["d4047ba.1ccb988"],[]]},{"id":"d4047ba.1ccb988","type":"function","z":"1a5b4ace.e30ef5","name":"Get Or Add New USer","func":"result = msg.payload.result;\ndelete msg.payload.filter;\ndelete msg.payload.result;\nif(JSON.stringify(result) === '{}'){\n    msg.payload.user = {\n        \"user_id\": msg.payload.userId.toString(),\n        \"chat_id\": msg.payload.chatId.toString(),\n        \"user_name\": msg.payload.username,\n        \"notification\" : true,\n        \"status\" : \"pending\"\n    };\n    return [msg ,null]\n}else{\n    msg.payload.user = result[0];\n    msg.payload.user.newUser = false;\n    return [null,msg];\n}\nreturn;","outputs":2,"noerr":0,"x":580,"y":200,"wires":[["2ded725a.ed761e"],[]]},{"id":"2ded725a.ed761e","type":"node-airtable","z":"1a5b4ace.e30ef5","name":"Add user to airtable","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"post","filter":"","filterType":"msg","record":"payload.user","recordType":"msg","records":"","recordsType":"msg","output":"payload.user","x":810,"y":180,"wires":[["1f781080.8af37"],[]]},{"id":"1f781080.8af37","type":"change","z":"1a5b4ace.e30ef5","name":"","rules":[{"t":"set","p":"payload.user.newUser","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":120,"wires":[[]]},{"id":"9e386759.bbfff8","type":"comment","z":"42aaf2dc.18badc","name":"Step I: Onboarding","info":"","x":210,"y":240,"wires":[]},{"id":"f0a93ae3.e17148","type":"change","z":"42aaf2dc.18badc","name":"","rules":[{"t":"set","p":"payload.username","pt":"msg","to":"originalMessage.from.username","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":320,"wires":[["dcd92f64.b3b22"]]},{"id":"dcd92f64.b3b22","type":"subflow:1a5b4ace.e30ef5","z":"42aaf2dc.18badc","name":"","env":[],"x":1130,"y":320,"wires":[["82d6000.9f821"],["64b84c92.2be5e4"]]},{"id":"64b84c92.2be5e4","type":"debug","z":"42aaf2dc.18badc","name":"InitUser: Error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1160,"y":380,"wires":[]},{"id":"50accbd2.4b3b44","type":"switch","z":"42aaf2dc.18badc","name":"","property":"payload.user.newUser","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1930,"y":320,"wires":[["1e4208b0.83edb7"],["1e4208b0.83edb7"]]},{"id":"6180e8ab.c76af8","type":"debug","z":"42aaf2dc.18badc","name":"Telegram Input Node","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":240,"y":320,"wires":[]},{"id":"24179a2b.532c16","type":"link in","z":"d7821d16.12614","name":"In: Sender Node","links":["7aed3dae.199544","82d39ccd.0eb9f","6894eeb4.56963","9e23aec9.8544b","dd9fe108.b255","6e787929.7ed6f8","2d8bbaae.ef3226","d8c74207.5e5c3","432016bc.94dcb8","be1f8e11.415f2","7fa98952.0a9f38","3933dd8.d824a22","eb03d39a.ec957","f51749be.e1b438","6de8a88d.3084e8","bcd877a4.8442a8","869522dc.15bd3","32596b5c.aff244","a0a5c983.918c88","1105712d.44886f","aaf52b6d.7f3658","a0e315c3.b7d328","7bd81e81.8176f","23ec474a.6746b8","92a7a9a7.8a05b8","2f85b7bb.ebf388","3a60333d.2ed34c","1744769c.142559","865fd3e7.03b5f","726b9915.74b5b8","df729b66.fde978","3c9ebcf.ff09044","e77262c.cf39ea","358d45ec.35b18a","325bb1a2.1c3a6e","dd2830f8.95373","18844b76.a630c5","6e9e625b.c25bec","bbddc5.083b8238","7ace94fc.f5e65c","d2d3a1b1.6e545","2e193665.896afa","d4ca7050.2c696","b090f494.d70ef8","7a6da5ad.ef573c","1059e118.552a9f","fb1dcf3e.93d62","694c5be4.b4bef4","f9b94395.38632","30f78d4a.7060f2","615f680.3f69e98","a8e13a38.5481f8","f8916861.fad2a8","cfebe793.7afea8","5e86ba08.082f64","942b53a.bc671b","75bf07cf.31b5b8","e333cc76.f0001","27beab63.3c9894","8fbdf496.d22598","f3255ab6.597d68","f138667c.1b29a8","ebba952a.1cf1f8","61a58c0d.2d4514","feaf7209.48b6a"],"x":215,"y":260,"wires":[["6932a56f.1d2a5c"]]},{"id":"ad7b27d2.2b73f8","type":"debug","z":"d7821d16.12614","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":625,"y":260,"wires":[]},{"id":"b0c4d273.9f915","type":"change","z":"d7821d16.12614","name":"","rules":[{"t":"set","p":"payload.type","pt":"msg","to":"action","tot":"str"},{"t":"set","p":"payload.content","pt":"msg","to":"typing","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":380,"wires":[["7294f7b7.b93f18"]]},{"id":"f957e9c9.d6cd48","type":"link in","z":"d7821d16.12614","name":"In: Typing","links":["21a1c78a.46f468","fa862f71.d969a","1c88f636.201aba","10b9e7e7.b6c948","d53b167a.063018","ed2fe047.7144f","bce18f81.355e1","edfab344.8e88c","24ca40ec.7ddef","1f1045ad.2294da","977dfd59.b84de"],"x":215,"y":380,"wires":[["b0c4d273.9f915"]]},{"id":"1e4208b0.83edb7","type":"link out","z":"42aaf2dc.18badc","name":"Out: RUE","links":["600ee386.d1951c"],"x":2075,"y":320,"wires":[]},{"id":"c033ec4e.8cc95","type":"chatbot-telegram-receive","z":"42aaf2dc.18badc","bot":"24145e37.52cb02","botProduction":"","x":210,"y":380,"wires":[["6180e8ab.c76af8","fce77b3a.abf648"]]},{"id":"6932a56f.1d2a5c","type":"chatbot-telegram-send","z":"d7821d16.12614","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":390,"y":260,"wires":[]},{"id":"7294f7b7.b93f18","type":"chatbot-telegram-send","z":"d7821d16.12614","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":610,"y":380,"wires":[]},{"id":"6a61c0e4.24de2","type":"function","z":"b49f190.95fa1e8","name":"Events from abi","func":"ethers = global.get('ethers');\niface = new ethers.utils.Interface (msg.payload.abi);\n\nevents = [];\n\nfor (const [key, value] of Object.entries(iface.events)) {\n    if (events.includes(value.name) === false) {\n        events.push(value.name);\n    }\n    // events.push({\n    //     key\n    //     \"name\" : value.name\n    // })\n}\n\nmsg.payload.events = events;\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":280,"wires":[[]]},{"id":"e4f8fbf8.368898","type":"function","z":"cb444aab.0c5578","name":"Contract Event Listener","func":"ethers = global.get('ethers');\nlet provider = ethers.getDefaultProvider(msg.payload.network);\nlet utils = ethers.utils;\n\nvar ContractAddress = msg.payload.address;\n\nlet abi = msg.payload.abi\n\nlet contract = new ethers.Contract(ContractAddress, abi, provider);\n\n// contract.on('CastVote', (event) => {\n//     msg.payload.CastVote = event;\n//     node.send(msg);\n// });\n\n// contract.on('CastVote', (parm1 , address, bool, uint256, event) => {\n//     msg.payload.CastVote = event;\n//     msg.payload.parm1 = parm1;\n//     msg.payload.address = address;\n//     msg.payload.bool = bool;\n//     msg.payload.uint256 = uint256;\n//     node.send(msg);\n// });\n\n// contract.on('CastVote', (parm1 , address, bool, uint256, event) => {\n//     msg.payload.CastVote = event;\n//     msg.payload.parm1 = parm1;\n//     msg.payload.address = address;\n//     msg.payload.bool = bool;\n//     msg.payload.uint256 = uint256;\n//     node.send(msg);\n// });\n\nif(msg.payload.eventName === undefined || msg.payload.eventName === 'all'){\n        contract.on({\n                address: msg.payload.address,\n            }, (...args) => {\n        msg.payload.event = args;\n        node.send(msg);\n    });\n}else {\n    contract.on(msg.payload.eventName, (...args) => {\n        msg.payload.event = args;\n        node.send(msg);\n    });\n}\n\n\n\n// contract.on('StartVote', (event) => {\n//     msg.payload.StartVote = event;\n//     node.send(msg);\n// });\n\n// contract.on('ExecuteVote', (event) => {\n//     msg.payload.ExecuteVote = event;\n//     node.send(msg);\n// });\n\n// contract.on(filter1, (event) => {\n//     msg.payload.contractEvent = event;\n//     node.send(msg);\n// });","outputs":1,"noerr":0,"x":390,"y":280,"wires":[[]]},{"id":"580d27ad.d0aa58","type":"chatbot-telegram-send","z":"7f4d87b0.2a1f88","bot":"24145e37.52cb02","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":370,"y":280,"wires":[["6330b3c0.27324c"]]},{"id":"6330b3c0.27324c","type":"subflow:1a5b4ace.e30ef5","z":"7f4d87b0.2a1f88","name":"","env":[],"x":590,"y":280,"wires":[[],[]]},{"id":"7d75d08d.133c6","type":"function","z":"42aaf2dc.18badc","name":"User Cache","func":"cache = global.get(msg.payload.user.fields.user_id);\nif(cache === undefined){\n    cache = {};\n    global.set(msg.payload.user.fields.user_id, cache);\n}\nreturn msg;","outputs":1,"noerr":0,"x":1530,"y":340,"wires":[["2d13f8bd.f658c8"]]},{"id":"80e03d3d.c9c22","type":"http request","z":"e76f3c6.e434dc","name":"","method":"GET","ret":"txt","paytoqs":true,"url":"https://api.telegram.org/bot958026503:AAFsjXW-9cE7wDdOKk4MfY2Fu6DrUhQ-NWo/deleteMessage","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":120,"wires":[[]]},{"id":"f3624a1d.fc5038","type":"function","z":"e76f3c6.e434dc","name":"","func":"//message_id = msg.originalMessage.message_id;\nmessage_id = msg.payload.message_id;\nchat_id = msg.payload.chatId;\nmsg.payload = {\n    chat_id,\n    message_id\n};\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":120,"wires":[["80e03d3d.c9c22"]]},{"id":"2d13f8bd.f658c8","type":"switch","z":"42aaf2dc.18badc","name":"","property":"originalMessage.chat.type","propertyType":"msg","rules":[{"t":"eq","v":"private","vt":"str"},{"t":"eq","v":"supergroup","vt":"str"},{"t":"eq","v":"group","vt":"str"},{"t":"eq","v":"otherwise","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":1750,"y":340,"wires":[["50accbd2.4b3b44"],["6393697c.61d668"],["6393697c.61d668"],[]]},{"id":"6393697c.61d668","type":"debug","z":"42aaf2dc.18badc","name":"Supergroup/Group","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1970,"y":380,"wires":[]},{"id":"194f3eb0.85c121","type":"function","z":"77241988.5609a8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\nconst {privateKey, address, action, debug, recipient, value, data, authKey } = msg.payload.sdkPayload;\n\nlet sdk;\nlet account;\nif(msg.payload.network === 'mainnet'){\n    sdk = abridged.createSdk({\n        authKeyModule: {\n          privateKey\n        },\n        queryProviderEndpoint: msg.payload.sdkPayload.queryProviderEndPoint,\n        fetch,\n        WebSocket\n    })\n}else{\n    sdk = abridged.createKovanSdk({\n        authKeyModule: {\n          privateKey\n        },\n        queryProviderEndpoint: msg.payload.sdkPayload.queryProviderEndPoint,\n        fetch,\n        WebSocket\n    })\n}\n\nmsg.payload.sdkPayload.gaurdianKey = sdk.state$.authKey$.address$._value;\n// connect sdk\nasync function createOrConnectAccount (){\n    try{\n        account = await sdk.createAccount(address);\n        msg.payload.sdkPayload.account = account;\n    }catch(error){\n        \n    }\n    if(debug)\n     node.warn(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: recipient,\n      value: value,\n      data: data,\n    };\n\n    try{\n       let batch = await sdk.batchExecuteAccountTransaction(options);\n       msg.payload.sdkPayload.batchExecute = batch;\n       if(debug)\n        node.warn(msg);\n    }catch(error){\n        msg.payload.sdkPayload.batchExecuteError = error;\n        throw error;\n    }\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: authKey,\n      type: \"Owner\"\n  })\n  msg.payload.sdkPayload.authKeyOutput = output;\n  if(debug)\n    node.warn(msg);\n}\n\nasync function estimateBatch() {\n    const refundToken = {}; // optional\n    try{\n        let batch = await sdk.estimateBatch(refundToken);\n        msg.payload.sdkPayload.estimateBatch = batch;\n        if(debug)\n            node.warn(msg);\n    }catch(error){\n        msg.payload.sdkPayload.estimateBatchError = error;\n        throw error;\n    }\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key;\n    try{\n        key = await sdk.submitBatch(gasPrice)\n        msg.payload.sdkPayload.submitBatchKey = key;\n        if(debug)\n            node.warn(msg);\n    }catch(error){\n       msg.payload.sdkPayload.submitBatchError = error;\n       throw error;\n    }\n    \n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        if (notification === null) {\n            // msg.payload.tempError = 'notification is null';\n            // node.send(msg,false);\n        }else{\n            if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n            // if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sent') {\n                msg.payload.sdkPayload.notification = notification.payload;\n                msg.payload.sdkPayload.done = true;\n                node.send(msg);\n                node.done();\n                // resolve(notification.payload.hash);\n                subscribtion.unsubscribe();\n                return;\n            }\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\nasync function process() {\n    await createOrConnectAccount();\n    if(action === \"SDK_ACTION_SET_AUTH_KEY\"){\n        try{\n            await setAuthKey(); \n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    } else if(action === \"SDK_ACTION_EXECUTE_TRX\"){\n        try{\n            await sdk.resetBatch();\n            await batchExecute();\n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            msg.payload.sdkPayload.error = error;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    }else {\n        await resetSdk();\n        msg.payload.sdkPayload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":480,"y":140,"wires":[[]]},{"id":"25145ec0.6b53a2","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.user.fields.account","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":520,"wires":[["4a4344ec.e6326c"],["edb4f105.da04e"]]},{"id":"4a4344ec.e6326c","type":"function","z":"c578ad64.4c8b1","name":"Create and attach abridged wallet","func":"ethers = global.get('ethers');\n\nlet wallet = ethers.Wallet.createRandom();\nmsg.payload.privateKey = wallet.privateKey;\nreturn msg;","outputs":1,"noerr":0,"x":980,"y":500,"wires":[["1f7b5ccf.5c8ff3"]]},{"id":"edb4f105.da04e","type":"node-airtable","z":"c578ad64.4c8b1","name":"Get Account","auth":"7ecc84ea.f9cb2c","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":910,"y":560,"wires":[["95f19464.76f2f8","1d018b87.ad5c64"],[]]},{"id":"95f19464.76f2f8","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1110,"y":600,"wires":[]},{"id":"1f7b5ccf.5c8ff3","type":"change","z":"c578ad64.4c8b1","name":"","rules":[{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.privateKey","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.debug","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":500,"wires":[["5d81ebae.b94a94"]]},{"id":"5d81ebae.b94a94","type":"subflow:77241988.5609a8","z":"c578ad64.4c8b1","name":"","env":[],"x":1510,"y":500,"wires":[["2d41ecf3.c87f54"]]},{"id":"4240ca02.327744","type":"function","z":"c578ad64.4c8b1","name":"Create new acccount entry","func":"\nif(msg.payload.encryptedData === undefined){\n    return [null, msg]\n}\n// \"pk\": msg.payload.sdkPayload.privateKey,\n// \"pk\": msg.payload.encryptedData,\nmsg.payload.payload = \n{\n    \"user_id\" : msg.payload.user.fields.user_id,\n    \"guardian_key\": msg.payload.sdkPayload.gaurdianKey,\n    \"account_address\": msg.payload.sdkPayload.account.address,\n    \"pk\": msg.payload.encryptedData,\n    \"external_deposit_address\": msg.payload.sdkPayload.account.externalDepositAddress,\n    \"wallet_type\" : \"abridged\"\n\n}\n\nreturn [ msg, null ];","outputs":2,"noerr":0,"x":1780,"y":560,"wires":[["5a2c5a8c.80bd44"],["ca7659a6.939148"]]},{"id":"5a2c5a8c.80bd44","type":"node-airtable","z":"c578ad64.4c8b1","name":"New Account","auth":"7ecc84ea.f9cb2c","table":"accounts","tableType":"str","action":"post","filter":"","filterType":"msg","record":"payload.payload","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.account","x":2060,"y":560,"wires":[["c74395be.96ce88"],[]]},{"id":"c74395be.96ce88","type":"change","z":"c578ad64.4c8b1","name":"","rules":[{"t":"delete","p":"payload.payload","pt":"msg"},{"t":"delete","p":"payload.sdkPayload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2250,"y":500,"wires":[["8d9da222.56a98"]]},{"id":"8d9da222.56a98","type":"function","z":"c578ad64.4c8b1","name":"Update User","func":"\nmsg.payload.payload = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"account\":[msg.payload.account.id]\n        }\n    }\n]\nreturn msg;","outputs":1,"noerr":0,"x":2450,"y":500,"wires":[["388238e5.7fd228"]]},{"id":"388238e5.7fd228","type":"node-airtable","z":"c578ad64.4c8b1","name":"Update User","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.user","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.record","x":2660,"y":500,"wires":[["fdfcc9bd.980098"],[]]},{"id":"fdfcc9bd.980098","type":"change","z":"c578ad64.4c8b1","name":"","rules":[{"t":"set","p":"payload.record[0]","pt":"msg","to":"payload.user","tot":"msg"},{"t":"move","p":"payload.account","pt":"msg","to":"payload.user.account","tot":"msg"},{"t":"delete","p":"payload.record","pt":"msg"},{"t":"delete","p":"payload.payload","pt":"msg"},{"t":"delete","p":"payload.privateKey","pt":"msg"},{"t":"delete","p":"payload.filterBy","pt":"msg"},{"t":"delete","p":"payload.content","pt":"msg"},{"t":"delete","p":"payload.tableName","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2850,"y":500,"wires":[["239803ff.4c04bc","fff2bf42.740f4"]]},{"id":"239803ff.4c04bc","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2720,"y":140,"wires":[]},{"id":"1d018b87.ad5c64","type":"link out","z":"c578ad64.4c8b1","name":"","links":["279aba9.08fc146"],"x":1295,"y":560,"wires":[]},{"id":"35b7ca17.270276","type":"function","z":"5667a237.c07e7c","name":"Get ERC 20 Token Balance","func":"ethers = global.get('ethers');\nlet provider = ethers.getDefaultProvider(msg.payload.network);\nlet contract = new ethers.Contract(msg.payload.address_contract, msg.payload.abi, provider);\n\nasync function getBalance () {\n    try{\n        const balance = await contract.balanceOf(msg.payload.address);\n        msg.payload.tokenBalance = ethers.utils.formatEther(balance);\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg);\n    node.done();\n}\n\ngetBalance();\nreturn;","outputs":1,"noerr":0,"x":560,"y":300,"wires":[[]]},{"id":"5dfeaeeb.33f7a","type":"function","z":"c5cd3a33.4dfa78","name":"Get Eth Bal","func":"fetch = global.get('fetch');\nethers = global.get('ethers');\npostData = {\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"eth_getBalance\",\n    \"params\": [\n        msg.payload.address,\n        \"latest\"\n    ],\n    \"id\": 1\n}\n\nasync function getBalance(url = '', data = {}) {\n  // Default options are marked with *\n  const response = await fetch(url, {\n    method: 'POST', // *GET, POST, PUT, DELETE, etc.\n    body: JSON.stringify(data) // body data type must match \"Content-Type\" header\n  });\n  return await response.json(); // parses JSON response into native JavaScript objects\n}\n\ngetBalance(msg.payload.queryProviderEndPoint, postData)\n  .then((data) => {\n    msg.payload.balance = ethers.utils.formatEther(data.result);\n    node.send(msg);\n    node.done();\n  });\n  ","outputs":1,"noerr":0,"x":550,"y":220,"wires":[[]]},{"id":"6a450de.d35bcf4","type":"debug","z":"c5cd3a33.4dfa78","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":300,"wires":[]},{"id":"7567445d.05c83c","type":"change","z":"6ee374ae.b9327c","name":"","rules":[{"t":"set","p":"payload.network","pt":"msg","to":"netwrok","tot":"global"},{"t":"set","p":"payload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":140,"wires":[["cfe3cd78.71dc3"]]},{"id":"cfe3cd78.71dc3","type":"subflow:c5cd3a33.4dfa78","z":"6ee374ae.b9327c","name":"","env":[],"x":440,"y":140,"wires":[["13bdcf53.5e7831"]]},{"id":"13bdcf53.5e7831","type":"change","z":"6ee374ae.b9327c","name":"","rules":[{"t":"set","p":"payload.address_contract","pt":"msg","to":"address_c19_token","tot":"global"},{"t":"set","p":"payload.abi","pt":"msg","to":"abi_erc20","tot":"global"},{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":140,"wires":[["95a66e94.5a5eb"]]},{"id":"95a66e94.5a5eb","type":"subflow:5667a237.c07e7c","z":"6ee374ae.b9327c","name":"","env":[],"x":900,"y":140,"wires":[[]]},{"id":"f2124ce8.2149b","type":"debug","z":"6ee374ae.b9327c","name":"User and group details","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":900,"y":200,"wires":[]},{"id":"83eb93c9.3b191","type":"debug","z":"6ee374ae.b9327c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":930,"y":80,"wires":[]},{"id":"de406f9.2dddf9","type":"debug","z":"6ee374ae.b9327c","name":"Input: ETH and Token Balance","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":230,"y":80,"wires":[]},{"id":"d1bafcbf.98a21","type":"function","z":"fe8354af.d82c38","name":"Encode Data","func":"ethers = global.get('ethers');\nlet iface = new ethers.utils.Interface(msg.payload.config.abi);\nlet encodedData = iface.functions[msg.payload.config.apiCall].encode(msg.payload.config.args);\nmsg.payload.config.encodedData = encodedData;\nreturn msg;\n","outputs":1,"noerr":0,"x":570,"y":240,"wires":[[]]},{"id":"70c35359.cacaac","type":"link in","z":"c578ad64.4c8b1","name":"In: Init Account","links":["cd0fb71a.c0a348","2b9bfc2a.618d44"],"x":495,"y":520,"wires":[["25145ec0.6b53a2"]]},{"id":"2369ad04.fd3ad2","type":"function","z":"c578ad64.4c8b1","name":"Purchase Eth","func":"if(msg.payload.balance === undefined)\n    msg.payload.balance = 0;\nwyreLink = global.get('wyre_link');\nwyreLink =  `${wyreLink}?destCurrency=ETH&dest=${msg.payload.user.account.fields.account_address}&account_id=AC_8MAWQ88LVEA`\n// wyreLink =  `${wyreLink}?destCurrency=ETH&dest=${msg.payload.user.account.fields.account_address}`\n\nbuttons = [];\n\nverificationUrl = `${global.get('web_wallet_url')}&id=${msg.payload.user.id}`\nabridgedWalletUrl = `${global.get('react_server_url')}/init?id=${msg.payload.user.id}&url=${global.get('node_red_server_url')}`\n\nbuttons.push(button = {\n\t\"type\": \"url\",\n\t\"label\": \"Wyre\",\n\t\"url\": wyreLink,\n\t\"alert\": false,\n\t\"style\": \"\"\n}, {\n\t\t\"type\": \"newline\"\n\t}, {\n\t\"type\": \"postback\",\n\t\"label\": \"Menu\",\n\t\"value\": \"/cancel\",\n\t\"answer\": \"\",\n\t\"alert\": false,\n\t\"style\": \"\"} )\n\nmsg.payload.type = \"inline-buttons\";\ntokenBalance = msg.payload.tokenBalance === undefined ? 0 : msg.payload.tokenBalance;\n\n\nmsg.payload.content = `\n* If you have ETH elsewhere: send to your address below\n\n* If you need ETH: purchase via debit card using the Wyre button \n\nYou will receive a notification when the transaction completes (up to 5 minutes).\n\nTransaction will take a few minutes to process.\n♢ETH balance:            ${msg.payload.balance}\n🔆C19 Token balance:  ${tokenBalance}\nAccount address:     ${msg.payload.user.account.fields.account_address}\n`;\n\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":1580,"wires":[["f515d74d.88ebb8","b4ce3f7b.fc36f","e8ef0368.6f901"]]},{"id":"f515d74d.88ebb8","type":"chatbot-telegram-send","z":"c578ad64.4c8b1","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":770,"y":1620,"wires":[]},{"id":"279aba9.08fc146","type":"link in","z":"c578ad64.4c8b1","name":"In: Wyre Flow","links":["c5a08f5c.7e75d","327ad4c1.46f64c","7a4f8493.68122c","a5c323af.9155f","2223c177.aa7eae","6c31f985.fd5c18","d587bde9.e22eb","f94b0f2b.7b6a8","1d018b87.ad5c64","4e8c11ae.a4bb1"],"x":135,"y":1580,"wires":[["8ee85cf3.79cee","76c417f5.348968"]]},{"id":"8ee85cf3.79cee","type":"chatbot-conversation","z":"c578ad64.4c8b1","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":310,"y":1580,"wires":[["2369ad04.fd3ad2"]]},{"id":"76c417f5.348968","type":"debug","z":"c578ad64.4c8b1","name":"Start Wyre Flow","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":300,"y":1540,"wires":[]},{"id":"32580b95.b62124","type":"simple-queue","z":"c578ad64.4c8b1","name":"Balance Queue","firstMessageBypass":true,"bypassInterval":"1000","x":1180,"y":1680,"wires":[["c525b67f.e06cd8"]]},{"id":"9be6edbf.59c04","type":"inject","z":"c578ad64.4c8b1","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":true,"onceDelay":"5","x":750,"y":1680,"wires":[["ee41b490.0fcaf8"]]},{"id":"ee41b490.0fcaf8","type":"change","z":"c578ad64.4c8b1","name":"","rules":[{"t":"set","p":"trigger","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":1680,"wires":[["32580b95.b62124"]]},{"id":"14b6b6c3.0ef379","type":"subflow:c5cd3a33.4dfa78","z":"c578ad64.4c8b1","name":"","env":[],"x":1620,"y":1680,"wires":[["104b9384.a1abec"]]},{"id":"c525b67f.e06cd8","type":"change","z":"c578ad64.4c8b1","name":"","rules":[{"t":"set","p":"payload.network","pt":"msg","to":"netwrok","tot":"global"},{"t":"set","p":"payload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.chatId","pt":"msg","to":"payload.user.fields.dm_id","tot":"msg"},{"t":"set","p":"payload.groupId","pt":"msg","to":"msg.payload.user.fields.group_id[0]","tot":"msg"},{"t":"set","p":"payload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":1680,"wires":[["14b6b6c3.0ef379"]]},{"id":"104b9384.a1abec","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.balance","propertyType":"msg","rules":[{"t":"lte","v":"payload.oldBalance","vt":"msg"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1830,"y":1680,"wires":[["7c78d345.a251ec"],["cbe5c8ab.f672d8","7f5a5dcd.407a44","ceecf1cb.90a24"]]},{"id":"ebf15c7d.5235","type":"debug","z":"c578ad64.4c8b1","name":"Listener Terminated","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":2210,"y":1620,"wires":[]},{"id":"6fc7b729.8a42a8","type":"debug","z":"c578ad64.4c8b1","name":"Balance Listener","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1710,"y":1720,"wires":[]},{"id":"f1c31ceb.f9a85","type":"delay","z":"c578ad64.4c8b1","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1480,"y":1620,"wires":[["32580b95.b62124"]]},{"id":"cbe5c8ab.f672d8","type":"chatbot-conversation","z":"c578ad64.4c8b1","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":2090,"y":1720,"wires":[["c2f371f1.e87db"]]},{"id":"c2f371f1.e87db","type":"function","z":"c578ad64.4c8b1","name":"Deposit Success","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Account`,\n\t\"value\": `/account`,\n\t\"style\": \"\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Menu`,\n\t\"value\": `/menu`,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `Success!!!\nETH balance:            ${msg.payload.balance}\nC19 Token balance:  ${tokenBalance}\n`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":2310,"y":1720,"wires":[["942b53a.bc671b"]]},{"id":"b4ce3f7b.fc36f","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":1540,"wires":[]},{"id":"6a39e638.9eed18","type":"comment","z":"c578ad64.4c8b1","name":"Wyre Flow","info":"","x":180,"y":1480,"wires":[]},{"id":"7c78d345.a251ec","type":"function","z":"c578ad64.4c8b1","name":"","func":"let cacheBalanceListener = flow.get('cache_balance_listener');\nif(cacheBalanceListener === undefined){\n    cacheBalanceListener = {}\n}\n\nlet count = cacheBalanceListener[msg.payload.userId.toString()] ;\nmsg.payload.count = count;\nif (isNaN(count))\n    count = 0;\ncount++;\n// msg.payload.count = count\nif(count > 200){ // 800 secs\n    return [null, msg]\n}\ncacheBalanceListener[msg.payload.userId.toString()] = count;\nflow.set('cache_balance_listener', cacheBalanceListener);\nreturn [ msg, null];","outputs":2,"noerr":0,"x":1950,"y":1620,"wires":[["f1c31ceb.f9a85"],["7f5a5dcd.407a44","ebf15c7d.5235"]]},{"id":"22b0426a.c0480e","type":"debug","z":"c578ad64.4c8b1","name":"Listening","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":2140,"y":1520,"wires":[]},{"id":"fff2bf42.740f4","type":"chatbot-conversation","z":"c578ad64.4c8b1","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":2390,"y":580,"wires":[["c302543c.be8cb8"]]},{"id":"c302543c.be8cb8","type":"function","z":"c578ad64.4c8b1","name":"Welcome message","func":"\n\nmsg.payload.type = 'inline-buttons'\nmsg.payload.name = 'Main Menu'\nmsg.payload.content = '*UNDER ACTIVE DEVELOPMENT*️\\n\\n⛑️HI! Welcome to Collab19!\\n\\nI was created to help people organize resources in a novel way.\\n\\nThe Collab19 is a non-profit initiative specifically formed to grant funds to those most affected by COVid-19.\\n\\n'\nmsg.payload.buttons = [{\n\t\t\"type\": \"newline\"\n\t}, {\n\t\t\"type\": \"postback\",\n\t\t\"label\": \"Main Menu\",\n\t\t\"value\": \"/menu\",\n\t\t\"answer\": \"\",\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n\t}, {\n\t\t\"type\": \"newline\"\n\t}, {\n\t\t\"type\": \"url\",\n\t\t\"label\": \"Learn More\",\n\t\t\"url\": \"https://collab19.live/\",\n\t\t\"webViewHeightRatio\": \"tall\",\n\t\t\"extensions\": false,\n\t\t\"answer\": \"\",\n\t\t\"alert\": false\n\t}]\n\t\nmsg.payload.chatId = msg.payload.user.fields.chat_id;\nreturn msg;\n\n\n// msg.payload.type = \"message\";\n// msg.payload.content = `\n// *UNDER ACTIVE DEVELOPMENT*\n\n// HI! Welcome to Collab19!\n\n// I was created to help people organize resources in a novel way. The Collab19 specifically formed to grant funds to those most affected by COVid-19.\n\n// Click the 'Learn More' button for more information, or continue to membership to participate. \n\n// Your account address is ${msg.payload.user.account.fields.account_address}\n\n// Please follow the Wyre button, or send $10-$20 (~0.05 ETH) to receive your C19 membership token and donate to the cause.\n// `;\n// return msg;","outputs":1,"noerr":0,"x":2610,"y":580,"wires":[["feaf7209.48b6a"]]},{"id":"6803f4aa.7dff3c","type":"link in","z":"c578ad64.4c8b1","name":"In: Accounts","links":["28015b70.5ca024","8bae259d.8ba3b8","760f79e.bddf588"],"x":155,"y":1960,"wires":[["9eea4e6c.388c7"]]},{"id":"9eea4e6c.388c7","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.user.fields.account","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":1960,"wires":[["efa3abf2.89cc68"],["887556fd.b0b978"]]},{"id":"887556fd.b0b978","type":"node-airtable","z":"c578ad64.4c8b1","name":"Get Account","auth":"7ecc84ea.f9cb2c","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":410,"y":2020,"wires":[["90ba9c9.060716"],[]]},{"id":"efa3abf2.89cc68","type":"chatbot-conversation","z":"c578ad64.4c8b1","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":585,"y":1920,"wires":[["fc452337.2b96b"]]},{"id":"fc452337.2b96b","type":"function","z":"c578ad64.4c8b1","name":"No associated account contract","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nmsg.payload.content = `\nHey, you do not have associated contract account. May be you are using metamask.\n`;\nreturn msg;","outputs":1,"noerr":0,"x":845,"y":1920,"wires":[["fb1dcf3e.93d62"]]},{"id":"750a72ce.64dd0c","type":"subflow:6ee374ae.b9327c","z":"c578ad64.4c8b1","name":"","env":[],"x":830,"y":2000,"wires":[["dc4b8978.51f1b8","418cb1e6.caa7b"]]},{"id":"1556d539.1e2a1b","type":"function","z":"c578ad64.4c8b1","name":"Account Details","func":"\nbuttons = [];\n\n \nbuttons.push({\n\t\"type\": \"postback\",\n\t\"label\": \"⛑️Donate to the Relief Fund\",\n\t\"value\": `/donate`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\nbuttons.push({\n     \"type\": \"newline\"\n});\n\nbuttons.push({\n\t\"type\": \"postback\",\n\t\"label\": \"Withdraw\",\n\t\"value\": `/transfereth`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\nbuttons.push({\n\t\"type\": \"postback\",\n\t\"label\": \"Add ETH\",\n\t\"value\": `/addeth`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\n\nbuttons.push({\n\t  \"type\": \"newline\"\n});\n\nbuttons.push({\n\t\"type\": \"postback\",\n\t\"label\": \"Menu\",\n\t\"value\": `/menu`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\t\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `Here is your account summary (reminder, this is on mainnet)\n\n♢ETH balance:            ${msg.payload.balance}\n🔆C19 Token:  ${msg.payload.tokenBalance}\nAccount address:     ${msg.payload.user.account.fields.account_address}\n\n`;\nmsg.payload.buttons = buttons;\nmsg.payload.chatId = msg.payload.user.fields.chat_id;\n\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":2000,"wires":[["fb1dcf3e.93d62"]]},{"id":"dc4b8978.51f1b8","type":"chatbot-conversation","z":"c578ad64.4c8b1","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":1070,"y":2000,"wires":[["1556d539.1e2a1b"]]},{"id":"7f5de96d.024538","type":"comment","z":"c578ad64.4c8b1","name":"Account Details","info":"","x":340,"y":1900,"wires":[]},{"id":"600ee386.d1951c","type":"link in","z":"c578ad64.4c8b1","name":"In: Contract Wallet","links":["5814e1d6.ca799","1e4208b0.83edb7"],"x":135,"y":640,"wires":[["f1630c2e.07e4b","bce18f81.355e1","f61113b3.189e"]]},{"id":"252b4c75.cb6704","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/account","vt":"str"},{"t":"eq","v":"/addeth","vt":"str"},{"t":"eq","v":"/addc19","vt":"str"},{"t":"eq","v":"nometamask","vt":"str"},{"t":"eq","v":"/swap","vt":"str"},{"t":"eq","v":"/swaptoeth","vt":"str"},{"t":"eq","v":"/transfereth","vt":"str"},{"t":"eq","v":"notification_off","vt":"str"},{"t":"eq","v":"notification_on","vt":"str"},{"t":"eq","v":"/donate","vt":"str"},{"t":"eq","v":"/signal","vt":"str"},{"t":"istype","v":"json","vt":"json"},{"t":"eq","v":"/fund","vt":"str"},{"t":"eq","v":"/membership","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":15,"x":1170,"y":820,"wires":[["8bae259d.8ba3b8"],["6c31f985.fd5c18"],["6e33d075.88a4a"],["2b9bfc2a.618d44"],["ee781be.ba921e8"],["86daa146.b717"],["6572a93.df86758"],["914af5b0.6afcc8"],["914af5b0.6afcc8"],["ead3e23e.5518d"],["3a425854.6cdad8"],["af0d9edc.b8a4b"],["5bd9ceb9.e15ca"],["a5a06dcf.d85ef"],["fb98a97c.65b748","127372ac.22097d"]]},{"id":"8bae259d.8ba3b8","type":"link out","z":"c578ad64.4c8b1","name":"","links":["6803f4aa.7dff3c"],"x":1335,"y":680,"wires":[]},{"id":"6c31f985.fd5c18","type":"link out","z":"c578ad64.4c8b1","name":"","links":["279aba9.08fc146"],"x":1335,"y":720,"wires":[]},{"id":"f1630c2e.07e4b","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.user.fields.account","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":410,"y":620,"wires":[["25145ec0.6b53a2"],["5263131.e3eddec"]]},{"id":"5263131.e3eddec","type":"node-airtable","z":"c578ad64.4c8b1","name":"Get Account","auth":"7ecc84ea.f9cb2c","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":710,"y":840,"wires":[["516ea74b.065238"],[]]},{"id":"516ea74b.065238","type":"subflow:6ee374ae.b9327c","z":"c578ad64.4c8b1","name":"","env":[],"x":930,"y":840,"wires":[["252b4c75.cb6704","f331e60c.aa36f8","b15cf67f.e3b328"]]},{"id":"6e33d075.88a4a","type":"link out","z":"c578ad64.4c8b1","name":"","links":[],"x":1375,"y":740,"wires":[]},{"id":"2b9bfc2a.618d44","type":"link out","z":"c578ad64.4c8b1","name":"","links":["70c35359.cacaac"],"x":1335,"y":760,"wires":[]},{"id":"fb98a97c.65b748","type":"debug","z":"c578ad64.4c8b1","name":"Contract Wallet: Unknown","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":960,"y":940,"wires":[]},{"id":"ee781be.ba921e8","type":"link out","z":"c578ad64.4c8b1","name":"","links":["da10593a.768f78","a0bc003f.3a4f9"],"x":1415,"y":760,"wires":[]},{"id":"f331e60c.aa36f8","type":"link out","z":"c578ad64.4c8b1","name":"","links":["aff2f4a4.99e888"],"x":1135,"y":680,"wires":[]},{"id":"aff2f4a4.99e888","type":"link in","z":"c578ad64.4c8b1","name":"","links":["f331e60c.aa36f8"],"x":815,"y":1520,"wires":[["e8ef0368.6f901"]]},{"id":"e8ef0368.6f901","type":"function","z":"c578ad64.4c8b1","name":"","func":"let cacheBalanceListener = flow.get('cache_balance_listener');\nif(cacheBalanceListener === undefined){\n    cacheBalanceListener = {}\n}\n\nlet count = cacheBalanceListener[msg.payload.userId.toString()] ;\nif (count > 0){ // already listening just reset counter\n    // delete cacheBalanceListener[msg.payload.userId.toString()];\n    // flow.set('cache_balance_listener', cacheBalanceListener);\n    return [msg, null];\n}\n\nmsg.payload.oldBalance = msg.payload.balance;\nreturn [null, msg]\n","outputs":2,"noerr":0,"x":990,"y":1580,"wires":[["71eaf86e.7c6d28"],["32580b95.b62124","5a9e16a9.02ca78","cffdfe9.1d666"]]},{"id":"71eaf86e.7c6d28","type":"debug","z":"c578ad64.4c8b1","name":"Already Listening, Reset to 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1320,"y":1560,"wires":[]},{"id":"7f5a5dcd.407a44","type":"function","z":"c578ad64.4c8b1","name":"Clear Listener","func":"let cacheBalanceListener = flow.get('cache_balance_listener');\ndelete cacheBalanceListener[msg.payload.userId.toString()];\nflow.set('cache_balance_listener', cacheBalanceListener);\nreturn;","outputs":1,"noerr":0,"x":2200,"y":1660,"wires":[[]]},{"id":"5a9e16a9.02ca78","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1210,"y":1600,"wires":[]},{"id":"86daa146.b717","type":"link out","z":"c578ad64.4c8b1","name":"Out: Swap to ETH","links":["c0aaddf3.dab42","40e72ca2.411ea4","42c5e19f.954ee"],"x":1375,"y":780,"wires":[]},{"id":"821f2a8.609a6d8","type":"link in","z":"59ce305.9861dd","name":"In: User Action","links":["1468912e.79ed0f","af0d9edc.b8a4b","7352c0ad.79852"],"x":135,"y":480,"wires":[["568d3188.b7017"]]},{"id":"568d3188.b7017","type":"json","z":"59ce305.9861dd","name":"","property":"payload.content","action":"obj","pretty":false,"x":270,"y":480,"wires":[["587340dc.2ed73","d2ddabb.c546958"]]},{"id":"54c78815.820168","type":"switch","z":"59ce305.9861dd","name":"","property":"payload.content.ac","propertyType":"msg","rules":[{"t":"eq","v":"vote_y","vt":"str"},{"t":"eq","v":"vote_n","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":665,"y":480,"wires":[["a7687849.80f7f8"],["a7687849.80f7f8"],["d73b81ab.0b368"]]},{"id":"d73b81ab.0b368","type":"debug","z":"59ce305.9861dd","name":"Unknown action","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":680,"y":540,"wires":[]},{"id":"a7687849.80f7f8","type":"subflow:6ee374ae.b9327c","z":"59ce305.9861dd","name":"","env":[],"x":890,"y":480,"wires":[["61b8fac0.9bd824","e677ff2c.62059"]]},{"id":"e677ff2c.62059","type":"function","z":"59ce305.9861dd","name":"Vote on app","func":"ethers = global.get(\"ethers\");\n\nlet abi = global.get(\"abi_aragon_app_voting\");\n\nif(msg.payload.balance <= global.get('min_eth_for_gas_fee')){\n    msg.payload.error = 'Please make sure to have enough ETH to pay for gas fee.';\n    return [null, msg];\n}\n\nif(msg.payload.tokenBalance <= 0){\n    msg.payload.error = 'Seems you dont have enough C19 token to vote.';\n    return [null, msg];\n}\n\nvote =   msg.payload.content.ac === 'vote_y' ? true : false\n\nmsg.payload.config = {\n  \"recipient\" : global.get('address_c19_voting_app'), // address received from JY\n  abi,\n  \"apiCall\" : \"vote\",\n  \"args\" : [parseInt(msg.payload.content.id), vote, true],\n  \"value\" : \"0x0\"\n};\n\n\nreturn [ msg, null ];\n\n","outputs":2,"noerr":0,"x":1130,"y":480,"wires":[["31fc3211.3d2cde","2a9c7516.59539a"],["31fc3211.3d2cde","462a220f.24e18c"]]},{"id":"462a220f.24e18c","type":"function","z":"59ce305.9861dd","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nmsg.payload.content = `${msg.payload.error}\n\n♢ETH balance:              ${msg.payload.balance}\n🔆C19 Token balance:            ${msg.payload.tokenBalance}\nAccount address:  ${msg.payload.user.account.fields.account_address}\n`;\n\nreturn msg;","outputs":1,"noerr":0,"x":1190,"y":540,"wires":[["75bf07cf.31b5b8"]]},{"id":"2a9c7516.59539a","type":"subflow:fe8354af.d82c38","z":"59ce305.9861dd","name":"","env":[],"x":1370,"y":480,"wires":[["66356dc7.8269e4","977dfd59.b84de","4300dc4b.f639b4"]]},{"id":"3ded40a3.78569","type":"change","z":"59ce305.9861dd","name":"","rules":[{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.account.fields.pk","tot":"msg"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"global"},{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.sdkPayload.data","pt":"msg","to":"payload.config.encodedData","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1740,"y":480,"wires":[["f71c0fc0.e3477"]]},{"id":"f71c0fc0.e3477","type":"subflow:77241988.5609a8","z":"59ce305.9861dd","name":"","env":[],"x":1960,"y":480,"wires":[["d6c4f238.94eb4","3f09ca90.83a1b6"]]},{"id":"d6c4f238.94eb4","type":"switch","z":"59ce305.9861dd","name":"","property":"payload.sdkPayload.done","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1710,"y":520,"wires":[["538592e5.6779ec"]]},{"id":"538592e5.6779ec","type":"function","z":"59ce305.9861dd","name":"Voting Result","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\nvoteId = msg.payload.content.id;\n\nif(msg.payload.sdkPayload.error === undefined){\n    \n    buttons = [];\n    buttons.push({\n    \t\"type\": \"url\",\n    \t\"label\": \"View Vote\",\n    \t\"url\": `${global.get('c19_app_url')}/${global.get('address_c19_voting_app')}/vote/${voteId}`,\n    \t\"alert\": false,\n    \t\"style\": \"\"\n    });\n    \n    buttons.push({\n    \t\"type\": \"url\",\n    \t\"label\": \"View Transaction\",\n    \t\"url\": `${global.get('ether_scan_url')}/tx/${msg.payload.sdkPayload.notification.hash}`,\n    \t\"alert\": false,\n    \t\"style\": \"\"\n    });\n    \n    buttons.push(button = {\n    \t\"type\": \"newline\"\n    });\n    \n    buttons.push(button = {\n    \t\"type\": \"postback\",\n    \t\"label\": `Menu`,\n    \t\"value\": `/menu`,\n    \t\"style\": \"\"\n    }); \n    \n    msg.payload.type = \"inline-buttons\";\n    msg.payload.content = `Thank you, your vote has been submitted.`;\n    msg.payload.buttons = buttons;\n}else{\n    msg.payload.type = \"message\";\n    msg.payload.content = `${msg.payload.sdkPayload.error} `\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1910,"y":520,"wires":[["8fbdf496.d22598"]]},{"id":"66356dc7.8269e4","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1390,"y":440,"wires":[]},{"id":"587340dc.2ed73","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":290,"y":520,"wires":[]},{"id":"61b8fac0.9bd824","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":520,"wires":[]},{"id":"31fc3211.3d2cde","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":440,"wires":[]},{"id":"d2ddabb.c546958","type":"node-airtable","z":"59ce305.9861dd","name":"Get Account","auth":"7ecc84ea.f9cb2c","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":490,"y":480,"wires":[["54c78815.820168","1f1045ad.2294da"],[]]},{"id":"8f209368.53aab","type":"inject","z":"c4310809.e61b28","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"3","x":210,"y":300,"wires":[["901bb17.106615","2064c224.4b974e"]]},{"id":"901bb17.106615","type":"debug","z":"c4310809.e61b28","name":"Collab19: Listener Input Node","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":290,"y":260,"wires":[]},{"id":"c34c928b.18a74","type":"function","z":"c4310809.e61b28","name":"Contract Event Listener","func":"ethers = global.get('ethers');\nlet provider = ethers.getDefaultProvider(msg.payload.network);\nlet utils = ethers.utils;\n\nvar ContractAddress = msg.payload.address;\nlet abi = msg.payload.abi\nlet contract = new ethers.Contract(ContractAddress, abi, provider);\n\ncontract.on(msg.payload.eventName, (...args) => {\n    msg.payload.event = args;\n    node.send(msg);\n});","outputs":1,"noerr":0,"x":970,"y":280,"wires":[["62d72679.6365e8","f29db671.af5838"]]},{"id":"f29db671.af5838","type":"debug","z":"c4310809.e61b28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":320,"wires":[]},{"id":"2064c224.4b974e","type":"change","z":"c4310809.e61b28","name":"","rules":[{"t":"set","p":"msg.payload.address","pt":"msg","to":"address_c19_voting_app","tot":"global"},{"t":"set","p":"msg.payload.network","pt":"msg","to":"mainnet","tot":"str"},{"t":"set","p":"msg.payload.abi","pt":"msg","to":"abi_aragon_app_voting","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":300,"wires":[["d3cb4802.90def8","460fc16b.fa559","d0737a8b.9efea8","deeeae91.45ce4"]]},{"id":"d3cb4802.90def8","type":"change","z":"c4310809.e61b28","name":"StartVote","rules":[{"t":"set","p":"payload.eventName","pt":"msg","to":"StartVote","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":220,"wires":[["c34c928b.18a74"]]},{"id":"460fc16b.fa559","type":"change","z":"c4310809.e61b28","name":"CastVote","rules":[{"t":"set","p":"payload.eventName","pt":"msg","to":"CastVote","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":280,"wires":[["c34c928b.18a74"]]},{"id":"d0737a8b.9efea8","type":"change","z":"c4310809.e61b28","name":"ExecuteVote","rules":[{"t":"set","p":"payload.eventName","pt":"msg","to":"ExecuteVote","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":340,"wires":[["c34c928b.18a74"]]},{"id":"deeeae91.45ce4","type":"change","z":"c4310809.e61b28","name":"All","rules":[{"t":"set","p":"payload.eventName","pt":"msg","to":"all","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":400,"wires":[[]]},{"id":"805ab91e.0e7a38","type":"link in","z":"c4310809.e61b28","name":"In: New Event","links":["62d72679.6365e8"],"x":155,"y":680,"wires":[["f666aab8.1a23c8","150519d2.a52d46"]]},{"id":"62d72679.6365e8","type":"link out","z":"c4310809.e61b28","name":"Out: New Event","links":["805ab91e.0e7a38"],"x":1155,"y":280,"wires":[]},{"id":"81bbf0c6.ea82","type":"switch","z":"c4310809.e61b28","name":"","property":"payload.eventName","propertyType":"msg","rules":[{"t":"eq","v":"StartVote","vt":"str"},{"t":"eq","v":"CastVote","vt":"str"},{"t":"eq","v":"ExecuteVote","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":430,"y":680,"wires":[["502c9367.303bfc"],["edaf2c78.829ed"],["dd684026.8e794"],["b7214aa8.cdef98"]]},{"id":"502c9367.303bfc","type":"function","z":"c4310809.e61b28","name":"New Vote Created Notification","func":"\nbuttons = [];\n\nvoteId = parseInt(msg.payload.event[0]._hex);\nvoteText = msg.payload.event[2];\nbuttons.push({\n\t\"type\": \"postback\",\n\t\"label\": \"Yes 👍\",\n\t\"value\": `{\"d\":\"ar\", \"ac\":\"vote_y\", \"id\":\"${voteId}\"}`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\nbuttons.push({\n\t\t\"type\": \"postback\",\n\t\t\"label\": \"No 👎\",\n\t\t\"value\": `{\"d\":\"ar\", \"ac\":\"vote_n\", \"id\":\"${voteId}\"}`,\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n\t});\n\nbuttons.push({\n\t        \"type\": \"newline\"\n});\n\n\nbuttons.push({\n\t\"type\": \"url\",\n\t\"label\": \"🔊 View Vote\",\n\t\"url\": `${global.get('c19_app_url')}/${global.get('address_c19_voting_app')}/vote/${voteId}`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\t\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Menu`,\n\t\"value\": `/menu`,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `New voting proposal \"${voteText}\" created. Vote# ${voteId}.\n\nVote using below buttons`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":600,"wires":[["a1d06e39.054f4"]]},{"id":"edaf2c78.829ed","type":"function","z":"c4310809.e61b28","name":"Cast vote","func":"\nbuttons = [];\nvoteId = parseInt(msg.payload.event[0]._hex);\nvoteValue = msg.payload.event[2];\nvoter = msg.payload.event[1];\n\nvoteValue = voteValue ? 'Yes' : 'No'\n\nbuttons.push({\n\t\t\"type\": \"url\",\n\t\t\"label\": \"🔊 View Vote\",\n\t\t\"url\": `${global.get('c19_app_url')}/${global.get('address_c19_voting_app')}/vote/${voteId}`,\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Menu`,\n\t\"value\": `/menu`,\n\t\"style\": \"\"\n});\n\t\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `New \"CastVote\" event for Vote# ${voteId}\nVote: ${voteValue}\nVoter: ${voter}\n`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":660,"wires":[["a1d06e39.054f4"]]},{"id":"a1d06e39.054f4","type":"function","z":"c4310809.e61b28","name":"Change","func":"msg.notification = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":900,"y":660,"wires":[["bbed490.77a2db8"]]},{"id":"bbed490.77a2db8","type":"link out","z":"c4310809.e61b28","name":"","links":["b493432b.edf05"],"x":1075,"y":660,"wires":[]},{"id":"f666aab8.1a23c8","type":"chatbot-conversation","z":"c4310809.e61b28","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"111","userId":"","transport":"telegram","store":"","x":270,"y":680,"wires":[["81bbf0c6.ea82"]]},{"id":"150519d2.a52d46","type":"debug","z":"c4310809.e61b28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":290,"y":640,"wires":[]},{"id":"b7214aa8.cdef98","type":"debug","z":"c4310809.e61b28","name":"Unhandled Vote Event","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":360,"y":740,"wires":[]},{"id":"5402ebec.f9d064","type":"switch","z":"c4310809.e61b28","name":"","property":"records","propertyType":"msg","rules":[{"t":"empty"},{"t":"nempty"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":1040,"wires":[[],["aa583cb1.a9798"]]},{"id":"d66e1c6a.c52b3","type":"debug","z":"c4310809.e61b28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":830,"y":1000,"wires":[]},{"id":"249fb14e.c16fde","type":"delay","z":"c4310809.e61b28","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":970,"y":1120,"wires":[["30694f7e.2ca24"]]},{"id":"aa583cb1.a9798","type":"array-loop","z":"c4310809.e61b28","name":"","key":"123","keyType":"msg","reset":false,"resetValue":"value-null","array":"records","arrayType":"msg","x":1050,"y":1060,"wires":[[],["249fb14e.c16fde"]]},{"id":"30694f7e.2ca24","type":"function","z":"c4310809.e61b28","name":"","func":"chatId = msg.payload.fields.chat_id;\nvoteEnabled = msg.payload.fields.account === undefined ? false : true;\n\nmsg.payload = msg.notification;\nmsg.payload.chatId = chatId;\n\nif(msg.payload.eventName === 'StartVote' && voteEnabled === false){\n    //do not how voting button\n    delete msg.payload.buttons[0];\n    delete msg.payload.buttons[1];\n    delete msg.payload.buttons[2];\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":1120,"wires":[["aa583cb1.a9798","b0658ff9.56c04","7ace94fc.f5e65c"]]},{"id":"87618c3b.1a043","type":"node-airtable","z":"c4310809.e61b28","name":"Get All Users","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"list","filter":"","filterType":"str","record":"","recordType":"msg","records":"","recordsType":"msg","output":"payload.records","x":370,"y":1040,"wires":[["ddc1a6d5.b4bab8"],[]]},{"id":"ddc1a6d5.b4bab8","type":"function","z":"c4310809.e61b28","name":"Notificattion enabled?","func":"\n// whiteListedUsers = flow.get('whitelisted');\n\nlet whiteListed = msg.payload.records.filter(record => record.fields.notification === true);\nmsg.records = whiteListed;\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":1040,"wires":[["5402ebec.f9d064","91279d97.7e0c9"]]},{"id":"91279d97.7e0c9","type":"debug","z":"c4310809.e61b28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":610,"y":1000,"wires":[]},{"id":"b0658ff9.56c04","type":"debug","z":"c4310809.e61b28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1170,"y":1160,"wires":[]},{"id":"b493432b.edf05","type":"link in","z":"c4310809.e61b28","name":"","links":["bbed490.77a2db8"],"x":195,"y":1040,"wires":[["87618c3b.1a043"]]},{"id":"7ace94fc.f5e65c","type":"link out","z":"c4310809.e61b28","name":"","links":["24179a2b.532c16"],"x":1335,"y":1120,"wires":[]},{"id":"dd684026.8e794","type":"function","z":"c4310809.e61b28","name":"ExecuteVote","func":"\nbuttons = [];\nvoteId = parseInt(msg.payload.event[0]._hex);\nvoteValue = msg.payload.event[1];\n\nvoteValue = voteValue ? 'Yes' : 'No'\n\nbuttons.push({\n\t\t\"type\": \"url\",\n\t\t\"label\": \"🔊 View Vote\",\n\t\t\"url\": `${global.get('c19_app_url')}/${global.get('address_c19_voting_app')}/vote/${voteId}`,\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Menu`,\n\t\"value\": `/menu`,\n\t\"style\": \"\"\n});\n\t\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `Vote# ${voteId} Executed\n`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":720,"wires":[["a6386a03.97a208","a1d06e39.054f4"]]},{"id":"a6386a03.97a208","type":"debug","z":"c4310809.e61b28","name":"Execute Vote Data","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":670,"y":760,"wires":[]},{"id":"6d02ee2d.38f02","type":"link in","z":"c578ad64.4c8b1","name":"In: Eth Trf","links":["7d2bae11.49b99","fac7aac7.c358c8","5b2e5531.3d877c"],"x":135,"y":2720,"wires":[["88e7c0b4.9ee1f","26306ebf.518cc2"]]},{"id":"9288c2b3.d1bd7","type":"comment","z":"c578ad64.4c8b1","name":"Transfer ETH","info":"","x":150,"y":2420,"wires":[]},{"id":"eb834e28.26b75","type":"subflow:6ee374ae.b9327c","z":"c578ad64.4c8b1","name":"","env":[],"x":710,"y":2720,"wires":[["bd086962.9f27a8"]]},{"id":"26306ebf.518cc2","type":"subflow:1a5b4ace.e30ef5","z":"c578ad64.4c8b1","name":"","env":[],"x":290,"y":2720,"wires":[["2a1619d0.20a8f6"],[]]},{"id":"2a1619d0.20a8f6","type":"node-airtable","z":"c578ad64.4c8b1","name":"Get Account","auth":"7ecc84ea.f9cb2c","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":490,"y":2720,"wires":[["eb834e28.26b75"],[]]},{"id":"bd086962.9f27a8","type":"function","z":"c578ad64.4c8b1","name":"Transfer eth to address","func":"const eth_sdk = global.get(\"ethsdk\");\nconst ethers = global.get(\"ethers\");\nconst gasFee = '0.002'\n\nif(msg.payload.balance < gasFee){ // gas fee for trf\n    msg.payload.error = 'Insufficient Balance, Transaction canceled.';\n    return [null, msg];\n}\n\nrequestedTrfAmount = ethers.utils.parseEther(msg.payload.amount);\nbalance = ethers.utils.parseEther(msg.payload.balance);\nif(balance.lt(requestedTrfAmount.add(ethers.utils.parseEther(gasFee)))){\n    msg.payload.error = 'Insufficient Balance, Transaction canceled.'\n    return [null, msg]\n}\n\nmsg.payload.config = {\n  \"recipient\" : msg.payload.recipient,\n  \"value\":  requestedTrfAmount.toHexString()\n};\n\nreturn [ msg, null ];\n\n","outputs":2,"noerr":0,"x":970,"y":2720,"wires":[["5e489559.a2f48c"],["33234dd2.489152"]]},{"id":"ef5332f0.aac0c","type":"change","z":"c578ad64.4c8b1","name":"","rules":[{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.account.fields.pk","tot":"msg"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"global"},{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"msg.payload.sdkPayload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.sdkPayload.value","pt":"msg","to":"payload.config.value","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":2720,"wires":[["f525355.ee38cc8"]]},{"id":"51f52408.0ab7dc","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.sdkPayload.done","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1650,"y":2740,"wires":[["6f11ccf8.9e3d64"]]},{"id":"8a6bde6a.10c3d","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1470,"y":2820,"wires":[]},{"id":"33234dd2.489152","type":"chatbot-conversation","z":"c578ad64.4c8b1","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"","store":"","x":930,"y":2780,"wires":[["20342f33.d98c1"]]},{"id":"20342f33.d98c1","type":"function","z":"c578ad64.4c8b1","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nmsg.payload.content = `${msg.payload.error}\n\n♢ETH balance:            ${msg.payload.balance}\n🔆Membership Token :  ${msg.payload.tokenBalance}\nAccount address:     ${msg.payload.user.account.fields.account_address}\n`;\n\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":2860,"wires":[["b090f494.d70ef8"]]},{"id":"6f11ccf8.9e3d64","type":"function","z":"c578ad64.4c8b1","name":"Eth Trf","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nif(msg.payload.sdkPayload.error === undefined){\n    buttons = [];\n    \n    buttons.push({\n\t\t\"type\": \"url\",\n\t\t\"label\": \"View Transaction\",\n\t\t\"url\": `${global.get('ether_scan_url')}/tx/${msg.payload.sdkPayload.notification.hash}`,\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n    });\n    buttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Account`,\n\t\"value\": `/account`,\n\t\"style\": \"\"\n    });\n\n    buttons.push(button = {\n    \t\"type\": \"postback\",\n    \t\"label\": `Menu`,\n    \t\"value\": `/menu`,\n    \t\"style\": \"\"\n    });\n    msg.payload.buttons = buttons;\n    msg.payload.type = \"inline-buttons\";\n    msg.payload.content = `Congrats!!! Eth transfer initiated, verify on etherscan `;\n}else{\n    msg.payload.content = `${msg.payload.sdkPayload.error} `\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1730,"y":2780,"wires":[["d4ca7050.2c696"]]},{"id":"6572a93.df86758","type":"link out","z":"c578ad64.4c8b1","name":"Out: Trf Eth","links":["2654cd7.44d6e32"],"x":1335,"y":800,"wires":[]},{"id":"2654cd7.44d6e32","type":"link in","z":"c578ad64.4c8b1","name":"On: Ask to account Address","links":["6572a93.df86758"],"x":135,"y":3120,"wires":[["f013ac78.9ad97","21536a4b.a0c8b6"]]},{"id":"21536a4b.a0c8b6","type":"function","z":"c578ad64.4c8b1","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.content = `\n♢ETH balance:              ${msg.payload.balance}\nAccount Address:  ${msg.payload.user.account.fields.account_address}\n\nPlease provide amount followed by recipient address. ex <amount> <address>\n`;\n\nmsg.payload.type = 'buttons';\nmsg.payload.buttons = [{\n\t\"type\": \"keyboardButton\",\n\t\"label\": \"Main Menu\"\n}]\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":3120,"wires":[["998499bd.832fe8"]]},{"id":"998499bd.832fe8","type":"chatbot-telegram-send","z":"c578ad64.4c8b1","bot":"24145e37.52cb02","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":490,"y":3120,"wires":[["9fa6098b.ce41b8"]]},{"id":"f525355.ee38cc8","type":"subflow:77241988.5609a8","z":"c578ad64.4c8b1","name":"","env":[],"x":1460,"y":2780,"wires":[["51f52408.0ab7dc","8a6bde6a.10c3d"]]},{"id":"a5227468.44c948","type":"subflow:6ee374ae.b9327c","z":"59ce305.9861dd","name":"","env":[],"x":910,"y":960,"wires":[["dc7c3b84.3e57f8","8a508440.b79c38"]]},{"id":"8a508440.b79c38","type":"function","z":"59ce305.9861dd","name":"Create Proposal","func":"ethers = global.get(\"ethers\");\n\nlet abi = global.get(\"abi_aragon_app_voting\");\n\nif(msg.payload.balance <= global.get('min_eth_for_gas_fee')){\n    msg.payload.error = 'Please make sure to have enough ETH to pay for gas fee.';\n    return [null, msg];\n}\n\nfunction encodeData(args) {\n    const votingAppAdd = global.get('address_c19_voting_app').replace('0x', ''); // old c19 voting app\n    let iface = new ethers.utils.Interface(abi);\n    let encodedData = iface.functions['newVote'].encode(args);\n    encodedData = encodedData.replace('0x', `0x00000001${votingAppAdd}000000c4`)\n    encodedData = encodedData.replace('0100000000', '0400000001')\n    console.log(encodedData);\n    msg.payload.enData = encodedData;\n    return encodedData;\n}\n\n_executtionScript = encodeData(['0x0', msg.payload.proposalData]);\n\nmsg.payload.config = {\n  \"recipient\" : \"0x9231549259236b5A8C74A7B537308AcdC0d1fa3f\",\n  abi,\n  \"apiCall\" : \"forward\",\n  \"args\" : [_executtionScript],\n  \"value\" : \"0x0\"\n};\n\nreturn [ msg, null ];\n\n","outputs":2,"noerr":0,"x":1180,"y":960,"wires":[["80227d32.e1bb7","873847e7.ae0c88"],["80227d32.e1bb7","fef25ba3.0285d8"]]},{"id":"fef25ba3.0285d8","type":"function","z":"59ce305.9861dd","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nmsg.payload.content = `${msg.payload.error}\n\nETH balance:            ${msg.payload.balance}\nC19 Token balance:  ${tokenBalance}\nAccount address:     ${msg.payload.user.account.fields.account_address}\n`;\n\nreturn msg;","outputs":1,"noerr":0,"x":1210,"y":1000,"wires":[["e333cc76.f0001"]]},{"id":"873847e7.ae0c88","type":"subflow:fe8354af.d82c38","z":"59ce305.9861dd","name":"","env":[],"x":1430,"y":960,"wires":[["db1ffa63.323278","24ca40ec.7ddef","b344c363.de1a7"]]},{"id":"607b5634.027208","type":"change","z":"59ce305.9861dd","name":"","rules":[{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.account.fields.pk","tot":"msg"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"global"},{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.sdkPayload.data","pt":"msg","to":"payload.config.encodedData","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1880,"y":960,"wires":[["6119870d.54b138"]]},{"id":"6119870d.54b138","type":"subflow:77241988.5609a8","z":"59ce305.9861dd","name":"","env":[],"x":2080,"y":980,"wires":[["8c86571c.3c86b8","8ea26ccd.5501b"]]},{"id":"8c86571c.3c86b8","type":"switch","z":"59ce305.9861dd","name":"","property":"payload.sdkPayload.done","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1850,"y":1020,"wires":[["661f7117.9b906"]]},{"id":"661f7117.9b906","type":"function","z":"59ce305.9861dd","name":"Proposal Result","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nif(msg.payload.sdkPayload.error === undefined){\n    \n    buttons = [];\n    buttons.push({\n    \t\"type\": \"url\",\n    \t\"label\": \"View Proposal\",\n    \t\"url\": `${global.get('c19_app_url')}/${global.get('address_c19_voting_app')}/`,\n    \t\"alert\": false,\n    \t\"style\": \"\"\n    });\n    \n    buttons.push({\n    \t\"type\": \"url\",\n    \t\"label\": \"View Transaction\",\n    \t\"url\": `${global.get('ether_scan_url')}/tx/${msg.payload.sdkPayload.notification.hash}`,\n    \t\"alert\": false,\n    \t\"style\": \"\"\n    });\n    \n    buttons.push(button = {\n    \t\"type\": \"newline\"\n    });\n    \n    buttons.push(button = {\n    \t\"type\": \"postback\",\n    \t\"label\": `Menu`,\n    \t\"value\": `/menu`,\n    \t\"style\": \"\"\n    }); \n    \n    msg.payload.type = \"inline-buttons\";\n    msg.payload.content = `Thank you, your prroposal has been submitted.`;\n    msg.payload.buttons = buttons;\n}else{\n    msg.payload.type = \"message\";\n    msg.payload.content = `${msg.payload.sdkPayload.error} `\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2060,"y":1020,"wires":[["27beab63.3c9894"]]},{"id":"db1ffa63.323278","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1470,"y":920,"wires":[]},{"id":"c56ea4f1.1773b8","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":1000,"wires":[]},{"id":"dc7c3b84.3e57f8","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":950,"y":1000,"wires":[]},{"id":"80227d32.e1bb7","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1470,"y":860,"wires":[]},{"id":"88464da8.a803d","type":"node-airtable","z":"59ce305.9861dd","name":"Get Account","auth":"7ecc84ea.f9cb2c","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":670,"y":960,"wires":[["a5227468.44c948","edfab344.8e88c"],[]]},{"id":"28415441.22803c","type":"subflow:1a5b4ace.e30ef5","z":"59ce305.9861dd","name":"","env":[],"x":410,"y":960,"wires":[["88464da8.a803d"],[]]},{"id":"c0929ec1.6b1ba","type":"link in","z":"59ce305.9861dd","name":"In: Create Proposal","links":["256dd365.266a1c"],"x":215,"y":960,"wires":[["28415441.22803c"]]},{"id":"8ea26ccd.5501b","type":"debug","z":"59ce305.9861dd","name":"SDK Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":2220,"y":920,"wires":[]},{"id":"42f4d01a.45158","type":"function","z":"c578ad64.4c8b1","name":"","func":"\ntry{\n    inputs = msg.payload.content.split(' ');\n    if(inputs === undefined || inputs.length !== 2){\n        msg.payload.content = `Invalid arguments. Use format below\n<amount> <recipient address>\n        `\n        msg.payload.type = 'buttons';\n        msg.payload.buttons = [{\n        \t\"type\": \"keyboardButton\",\n        \t\"label\": \"Main Menu\"\n        }]\n        return [null, msg, null];\n    }\n    if(isNaN(inputs[0])){\n        msg.payload.content = `Invalid amount. Use format below\n<amount> <recipient address>\n        `\n        msg.payload.type = 'buttons';\n        msg.payload.buttons = [{\n        \t\"type\": \"keyboardButton\",\n        \t\"label\": \"Main Menu\"\n        }]\n        return [null, msg, null];\n    }\n    msg.payload.inputs = inputs;\n}catch(error){\n    msg.payload.content = error;\n    return [null, null, msg];\n}\n\nreturn [msg, null, null];","outputs":3,"noerr":0,"x":830,"y":3120,"wires":[["ec6f28bd.23abf8","6d9ee4e4.573d5c"],["998499bd.832fe8"],["2e193665.896afa"]]},{"id":"f013ac78.9ad97","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":330,"y":3080,"wires":[]},{"id":"ec6f28bd.23abf8","type":"debug","z":"c578ad64.4c8b1","name":"Confirm","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1000,"y":3080,"wires":[]},{"id":"6d9ee4e4.573d5c","type":"function","z":"c578ad64.4c8b1","name":"Send ETH confirmation","func":"\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Confirm 👍`,\n\t\"value\": `${msg.payload.inputs[0]} ${msg.payload.inputs[1]}`,\n\t\"style\": \"\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Reject 👎`,\n\t\"value\": `/reject`,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `\nTransaction summarry:\nETH amount: ${msg.payload.inputs[0]}\nRecipient: ${msg.payload.inputs[1]}\n`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":3120,"wires":[["e7915ccc.da0f8"]]},{"id":"e7915ccc.da0f8","type":"chatbot-telegram-send","z":"c578ad64.4c8b1","bot":"24145e37.52cb02","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":1310,"y":3120,"wires":[["c4e26c9e.1640a","ce915bdb.f662a8","642845ca.b5289c"]]},{"id":"c4e26c9e.1640a","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1330,"y":3080,"wires":[]},{"id":"ce915bdb.f662a8","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/reject","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":3120,"wires":[["da970522.599fd8"],["afdfe31c.fa94"]]},{"id":"d2d3a1b1.6e545","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":1815,"y":3100,"wires":[]},{"id":"2e193665.896afa","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":995,"y":3180,"wires":[]},{"id":"d4ca7050.2c696","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":1835,"y":2780,"wires":[]},{"id":"b090f494.d70ef8","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":1035,"y":2860,"wires":[]},{"id":"fb1dcf3e.93d62","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":1110,"y":1920,"wires":[]},{"id":"da970522.599fd8","type":"function","z":"c578ad64.4c8b1","name":"","func":"msg.payload.content = `Tranaction canceled!!!`\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":3100,"wires":[["d2d3a1b1.6e545"]]},{"id":"afdfe31c.fa94","type":"function","z":"c578ad64.4c8b1","name":"","func":"inputs = msg.payload.content.split(' ');\nif(inputs === undefined || inputs.length !== 2){\n    msg.payload.content = `Invalid arguments. Transaction canceled`\n    return [msg, null];\n}\n\nmsg.payload.amount = inputs[0];\nmsg.payload.recipient = inputs[1];\n\nreturn [null, msg];","outputs":2,"noerr":0,"x":1670,"y":3140,"wires":[["d2d3a1b1.6e545"],["7d2bae11.49b99"]]},{"id":"7d2bae11.49b99","type":"link out","z":"c578ad64.4c8b1","name":"","links":["6d02ee2d.38f02"],"x":1815,"y":3160,"wires":[]},{"id":"88e7c0b4.9ee1f","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":230,"y":2760,"wires":[]},{"id":"ead3e23e.5518d","type":"link out","z":"c578ad64.4c8b1","name":"","links":["d9000593.918678","355900cb.1d9c3"],"x":1415,"y":840,"wires":[]},{"id":"81db17c8.5c2db8","type":"inject","z":"5760092e.43a578","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":970,"y":380,"wires":[["300fa2ab.63a77e"]]},{"id":"9ea447eb.ba6b18","type":"function","z":"5760092e.43a578","name":"Trf C19 token to address","func":"\nethers = global.get(\"ethers\");\n\nlet abi = global.get(\"abi_erc20\");\nnumOfTokens = ethers.utils.parseEther('1');\n\nmsg.payload.config = {\ncontractAddress: global.get('address_c19_token'),\n  abi,\n  \"pk\" : global.get('pk_c19_token_holder'),\n  \"apiCall\" : \"transfer\", \n  \"args\" : [msg.payload.recipient, numOfTokens]\n}\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":480,"wires":[["84695608.daf8a8","c65939b2.8672c8"]]},{"id":"c65939b2.8672c8","type":"function","z":"5760092e.43a578","name":"Contract Executor ","func":"ethers = global.get('ethers');\nlet network  = 'mainnet'\n\nlet { pk, contractAddress, apiCall, args, abi, byteCode } = msg.payload.config;\nconst provider = ethers.getDefaultProvider(network);\n\nlet wallet;\nlet contract;\n\nif(pk){\n    wallet = new ethers.Wallet(pk, provider);\n    contract = new ethers.Contract(contractAddress, abi, wallet);\n}else{\n    // read only\n     contract = new ethers.Contract(contractAddress, abi, provider);\n}\n\n// All overrides are optional\nlet overrides = {\n    // The maximum units of gas for the transaction to use\n    gasLimit: 500000,\n\n    // The price (in wei) per unit of gas\n    gasPrice: ethers.utils.parseUnits('8.0', 'gwei'),\n\n};\n\nargs.push(overrides);\n\n\nlet func = contract[apiCall];\nasync function process () {\n    try{\n        let resp = await func.apply(node, args);\n        // msg.payload.trxHash = resp.hash;\n        msg.payload.response = resp;\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg, false);\n    node.done();\n    return;\n}\n\nprocess();\n\nreturn;","outputs":1,"noerr":0,"x":1310,"y":480,"wires":[["d5ad911a.cbd88","ce456fbb.95584"]]},{"id":"d5ad911a.cbd88","type":"function","z":"5760092e.43a578","name":"","func":"if(msg.payload.error === undefined){\n    return [msg, null]\n}else{\n    msg.payload.type = 'message';\n    msg.payload.content = msg.payload.error\n    return [null, msg]\n}\n\n","outputs":2,"noerr":0,"x":1550,"y":480,"wires":[["7e0acacc.466884","7ba2bdc0.4a03a4"],["5843cda1.041eb4","f138667c.1b29a8"]]},{"id":"ce456fbb.95584","type":"debug","z":"5760092e.43a578","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1350,"y":420,"wires":[]},{"id":"7e0acacc.466884","type":"debug","z":"5760092e.43a578","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1570,"y":420,"wires":[]},{"id":"1b4c8156.ebabaf","type":"link in","z":"5760092e.43a578","name":"In: trf c19 token","links":["ceecf1cb.90a24","d1a79c28.7fdf8","203b1f7b.c2b41"],"x":155,"y":480,"wires":[["53312818.152a18"]]},{"id":"300fa2ab.63a77e","type":"change","z":"5760092e.43a578","name":"","rules":[{"t":"set","p":"msg.payload.recipient","pt":"msg","to":"0x4B4607Cd49B243E75afDc8b30E5E1bB1019Db089","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":420,"wires":[["9ea447eb.ba6b18"]]},{"id":"ceecf1cb.90a24","type":"link out","z":"c578ad64.4c8b1","name":"Out: Trf New C19 Token","links":["1b4c8156.ebabaf"],"x":2035,"y":1800,"wires":[]},{"id":"8bf2a6ea.9722e8","type":"comment","z":"5760092e.43a578","name":"Check if already have token","info":"","x":480,"y":420,"wires":[]},{"id":"d3778f2d.007db","type":"subflow:5667a237.c07e7c","z":"5760092e.43a578","name":"","env":[],"x":580,"y":480,"wires":[["6bf4c779.edb108"]]},{"id":"53312818.152a18","type":"change","z":"5760092e.43a578","name":"","rules":[{"t":"set","p":"payload.address_contract","pt":"msg","to":"address_c19_token","tot":"global"},{"t":"set","p":"payload.abi","pt":"msg","to":"abi_erc20","tot":"global"},{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"},{"t":"set","p":"payload.recipient","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":480,"wires":[["d3778f2d.007db"]]},{"id":"84695608.daf8a8","type":"debug","z":"5760092e.43a578","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1030,"y":540,"wires":[]},{"id":"6bf4c779.edb108","type":"switch","z":"5760092e.43a578","name":"","property":"payload.tokenBalance","propertyType":"msg","rules":[{"t":"lt","v":"1","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":480,"wires":[["995ff4c8.e979c8","9ea447eb.ba6b18"],["9c0a34e7.939a48"]]},{"id":"9c0a34e7.939a48","type":"debug","z":"5760092e.43a578","name":"Already have token, do not transfer","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":700,"y":540,"wires":[]},{"id":"82d6000.9f821","type":"switch","z":"42aaf2dc.18badc","name":"","property":"maintenance","propertyType":"global","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1310,"y":320,"wires":[["90f3f150.c18b1","8bbc5b52.fdae88"],["7d75d08d.133c6"]]},{"id":"30f78d4a.7060f2","type":"link out","z":"42aaf2dc.18badc","name":"","links":["24179a2b.532c16"],"x":1795,"y":280,"wires":[]},{"id":"90f3f150.c18b1","type":"switch","z":"42aaf2dc.18badc","name":"","property":"payload.user.fields.whitelisted","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":280,"wires":[["7d75d08d.133c6"],["b20b0e24.6c392"]]},{"id":"b20b0e24.6c392","type":"function","z":"42aaf2dc.18badc","name":"","func":"msg.payload.content = `Collab19 is currently whitelisted. Please contact @OKduncan for access.\n`\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":280,"wires":[["30f78d4a.7060f2"]]},{"id":"8bbc5b52.fdae88","type":"debug","z":"42aaf2dc.18badc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1270,"y":280,"wires":[]},{"id":"615f680.3f69e98","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":1875,"y":960,"wires":[]},{"id":"42c5e19f.954ee","type":"link in","z":"7780ff54.b10e1","name":"In: Swap To ETH","links":["86daa146.b717"],"x":155,"y":300,"wires":[[]]},{"id":"7c039a72.2b5c34","type":"switch","z":"7780ff54.b10e1","name":"","property":"payload.user.fields.whitelisted","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":300,"wires":[["7ebcd681.76a748"],["60898444.0d733c"]]},{"id":"7ebcd681.76a748","type":"subflow:6ee374ae.b9327c","z":"7780ff54.b10e1","name":"","env":[],"x":485,"y":360,"wires":[["64f3a6cd.34e348"]]},{"id":"64f3a6cd.34e348","type":"function","z":"7780ff54.b10e1","name":"UNISWAP: Token To ETH","func":"ethers = global.get(\"ethers\");\n\nlet abi = global.get(\"abi_exchange_uniswap\");\nconst tokens_sold = ethers.utils.parseEther(msg.payload.tokenBalance);\nif(tokens_sold <= 0){\n    msg.payload.error = 'Can not initate swap, token balance is 0';\n    return [null, msg];\n}\n\nif(msg.payload.balance <= global.get('min_eth_for_gas_fee')){\n    msg.payload.error = 'Please make sure to have enough ETH to pay for gas fee.';\n    return [null, msg];\n}\n\nmin_eth = ethers.utils.parseEther('0.000000000000000001');\n\nmsg.payload.config = {\n  \"recipient\" : global.get('address_uniswap_c19_exchange'),\n  abi,\n  \"apiCall\" : \"tokenToEthSwapInput\",\n  \"value\" : ethers.utils.parseEther('0').toHexString(),\n  \"args\" : [tokens_sold, min_eth, ethers.utils.parseEther('100')]\n};\n\n\nreturn [ msg, null ];\n\n","outputs":2,"noerr":0,"x":765,"y":360,"wires":[["25108c7f.9ad184","7cccb936.5e8738"],["b7761e9d.523c8","92a90cf8.5faa9"]]},{"id":"25108c7f.9ad184","type":"subflow:fe8354af.d82c38","z":"7780ff54.b10e1","name":"","env":[],"x":1005,"y":360,"wires":[["c754930d.a7ddf"]]},{"id":"c754930d.a7ddf","type":"change","z":"7780ff54.b10e1","name":"","rules":[{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.account.fields.pk","tot":"msg"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"global"},{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.sdkPayload.data","pt":"msg","to":"payload.config.encodedData","tot":"msg"},{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1195,"y":360,"wires":[["c13fcc47.36047"]]},{"id":"c13fcc47.36047","type":"subflow:77241988.5609a8","z":"7780ff54.b10e1","name":"","env":[],"x":1120,"y":420,"wires":[["9aaa4d39.e7789","959ce8a3.18a148"]]},{"id":"9aaa4d39.e7789","type":"switch","z":"7780ff54.b10e1","name":"","property":"payload.sdkPayload.done","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1290,"y":420,"wires":[["f08eda93.39bc78"]]},{"id":"f08eda93.39bc78","type":"chatbot-conversation","z":"7780ff54.b10e1","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"","store":"","x":1450,"y":420,"wires":[["935f993b.25df68"]]},{"id":"935f993b.25df68","type":"function","z":"7780ff54.b10e1","name":"Uniswap Success Message","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nif(msg.payload.sdkPayload.error === undefined){\n    msg.payload.content = `Congrats!!! SWAP transaction is initiate, verify on etherscan here ${global.get('ether_scan_url')}/tx/${msg.payload.sdkPayload.notification.hash}`;\n}else{\n    msg.payload.content = `Error ${msg.payload.sdkPayload.error} `\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1200,"y":480,"wires":[["f8916861.fad2a8"]]},{"id":"6aad2213.8df3bc","type":"comment","z":"7780ff54.b10e1","name":"SWAP Token to ETH","info":"","x":790,"y":240,"wires":[]},{"id":"b7761e9d.523c8","type":"chatbot-conversation","z":"7780ff54.b10e1","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"","store":"","x":750,"y":420,"wires":[["73bd8b5d.59f494"]]},{"id":"73bd8b5d.59f494","type":"function","z":"7780ff54.b10e1","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nmsg.payload.content = `${msg.payload.error}\n\n♢ETH balance:              ${msg.payload.balance}\n🔆C19 balance:            ${msg.payload.tokenBalance}\nAccount Address:  ${msg.payload.user.account.fields.account_address}\n`;\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":480,"wires":[["a8e13a38.5481f8"]]},{"id":"959ce8a3.18a148","type":"debug","z":"7780ff54.b10e1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1320,"y":520,"wires":[]},{"id":"7cccb936.5e8738","type":"debug","z":"7780ff54.b10e1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":940,"y":320,"wires":[]},{"id":"92a90cf8.5faa9","type":"debug","z":"7780ff54.b10e1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":710,"y":300,"wires":[]},{"id":"d396567c.1392f8","type":"comment","z":"7780ff54.b10e1","name":"SWAP Token to ETH (inject)","info":"","x":180,"y":100,"wires":[]},{"id":"60898444.0d733c","type":"debug","z":"7780ff54.b10e1","name":"User is not whitelisted","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":300,"y":380,"wires":[]},{"id":"a8e13a38.5481f8","type":"link out","z":"7780ff54.b10e1","name":"","links":["24179a2b.532c16"],"x":795,"y":540,"wires":[]},{"id":"f8916861.fad2a8","type":"link out","z":"7780ff54.b10e1","name":"","links":["24179a2b.532c16"],"x":1435,"y":480,"wires":[]},{"id":"355900cb.1d9c3","type":"link in","z":"c578ad64.4c8b1","name":"On: Ask to account Address","links":["ead3e23e.5518d"],"x":135,"y":2360,"wires":[["f6b2f676.ff3d68","88e045f2.13b978"]]},{"id":"f6b2f676.ff3d68","type":"function","z":"c578ad64.4c8b1","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.content = `\n♢ETH balance:              ${msg.payload.balance}\nAccount Address:  ${msg.payload.user.account.fields.account_address}\n\nPlease provide ETH donation amount (transaction will take a few minutes)\n`;\n\nmsg.payload.type = 'buttons';\nmsg.payload.buttons = [{\n\t\"type\": \"keyboardButton\",\n\t\"label\": \"Main Menu\"\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":2360,"wires":[["d1c4d624.8cbdc8"]]},{"id":"d1c4d624.8cbdc8","type":"chatbot-telegram-send","z":"c578ad64.4c8b1","bot":"24145e37.52cb02","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":430,"y":2360,"wires":[["cfbcf370.36904","43dd3302.aed98c"]]},{"id":"a1eae70d.97beb8","type":"function","z":"c578ad64.4c8b1","name":"","func":"\ntry{\n    if(isNaN(msg.payload.content)){\n        msg.payload.content = `Invalid amount. Please enter valid amount.`\n        msg.payload.type = 'buttons';\n        msg.payload.buttons = [{\n            \"type\": \"keyboardButton\",\n            \"label\": \"Main Menu\"\n        }]\n        return [null, msg, null];\n    }\n}catch(error){\n    msg.payload.content = error;\n    return [null, null, msg];\n}\n\nreturn [msg, null, null];","outputs":3,"noerr":0,"x":650,"y":2360,"wires":[["388e3023.d07ec","7c361b99.3436c4"],["d1c4d624.8cbdc8"],["5e86ba08.082f64"]]},{"id":"88e045f2.13b978","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":270,"y":2320,"wires":[]},{"id":"388e3023.d07ec","type":"debug","z":"c578ad64.4c8b1","name":"Confirm","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":840,"y":2300,"wires":[]},{"id":"7c361b99.3436c4","type":"function","z":"c578ad64.4c8b1","name":"Donation Summary","func":"\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Confirm 👍`,\n\t\"value\": `${msg.payload.content} ${global.get('donation_address')}`,\n\t\"style\": \"\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Reject 👎`,\n\t\"value\": `/reject`,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `\nDonation summarry:\nETH amount: ${msg.payload.content}\nRecipient: ${global.get('donation_address')}\n`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":2340,"wires":[["128784ad.6c931b"]]},{"id":"128784ad.6c931b","type":"chatbot-telegram-send","z":"c578ad64.4c8b1","bot":"24145e37.52cb02","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":870,"y":2380,"wires":[["9490b9f4.ad9278","92de2829.ffce88","1397ac00.9f68c4"]]},{"id":"9490b9f4.ad9278","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1110,"y":2440,"wires":[]},{"id":"92de2829.ffce88","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/reject","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1130,"y":2380,"wires":[["279de16e.ba4ace"],["e4ff8f3b.e4d21"]]},{"id":"cfebe793.7afea8","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":1495,"y":2340,"wires":[]},{"id":"5e86ba08.082f64","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":775,"y":2440,"wires":[]},{"id":"279de16e.ba4ace","type":"function","z":"c578ad64.4c8b1","name":"","func":"msg.payload.content = `Tranaction canceled!!!`\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":2340,"wires":[["cfebe793.7afea8"]]},{"id":"e4ff8f3b.e4d21","type":"function","z":"c578ad64.4c8b1","name":"","func":"inputs = msg.payload.content.split(' ');\nif(inputs === undefined || inputs.length !== 2){\n    msg.payload.content = `Invalid arguments. Transaction canceled`\n    return [msg, null];\n}\n\nmsg.payload.amount = inputs[0];\nmsg.payload.recipient = inputs[1];\n\nreturn [null, msg];","outputs":2,"noerr":0,"x":1310,"y":2380,"wires":[["cfebe793.7afea8"],["5b2e5531.3d877c"]]},{"id":"5b2e5531.3d877c","type":"link out","z":"c578ad64.4c8b1","name":"","links":["6d02ee2d.38f02"],"x":1415,"y":2400,"wires":[]},{"id":"a0bc003f.3a4f9","type":"link in","z":"7780ff54.b10e1","name":"In: Uniswap","links":["814dbd31.3bdcd","975cbecd.ca0a2","aceb4f5c.08c55","43f45740.934618","503d4305.f7571c","bb97b23b.b7231","ee781be.ba921e8"],"x":195,"y":860,"wires":[[]]},{"id":"f25f0c13.a7eae","type":"comment","z":"7780ff54.b10e1","name":"SWAP","info":"We are asking for token Symobol and Token contract address. \n- Need to call uniswap exchange contract to get\n    - token exchange address if exists.\n    - if exists then check token price?\n    - swap ETH for token","x":290,"y":780,"wires":[]},{"id":"b0ce7dc4.a9e2c","type":"function","z":"7780ff54.b10e1","name":"UNISWAP: ETH TO Token","func":"ethers = global.get(\"ethers\");\n\nlet abi = global.get(\"abi_exchange_uniswap\");\netherAmount = ethers.utils.parseEther(msg.payload.balance);\nlet gasBuffer = ethers.utils.parseEther(flow.get('gas_buffer'));\n\nswapAmount = etherAmount.sub(gasBuffer);\n\n// calculate 0.5% of swap amount\nmargin = ethers.utils.parseEther('0.5');\nfact = ethers.utils.parseEther('100');\npercMul = margin.mul(swapAmount);\nperc = percMul.div(fact);\n\nswapAmount = swapAmount.sub(perc);\nmsg.payload.swapAmount = swapAmount;\nmsg.payload.perc = perc;\nmsg.payload.gasBuffer = gasBuffer;\n\n\nif(swapAmount.lte(ethers.utils.bigNumberify('0'))){\n    return [null, msg];\n}\n\nswapAmount = swapAmount.toHexString();\n\nmimToken = ethers.utils.parseEther('0.0000000000000001');\n\nmsg.payload.config = {\n//   \"recipient\" : \"0x8779C708e2C3b1067de9Cd63698E4334866c691C\", // dai uniswap exchange address\n  \"recipient\" : global.get('address_uniswap_c19_exchange'),\n  abi,\n  \"apiCall\" : \"ethToTokenSwapInput\",\n  \"value\" : swapAmount,\n  \"args\" : [mimToken, ethers.utils.parseEther('100')]\n};\n\n\nreturn [ msg, null ];\n\n","outputs":2,"noerr":0,"x":350,"y":920,"wires":[["80608f86.635dd","a792eb54.0450a8"],["af2f077.7077af8"]]},{"id":"80608f86.635dd","type":"subflow:fe8354af.d82c38","z":"7780ff54.b10e1","name":"","env":[],"x":670,"y":920,"wires":[["c04f31e2.03687"]]},{"id":"c04f31e2.03687","type":"change","z":"7780ff54.b10e1","name":"","rules":[{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.account.fields.pk","tot":"msg"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"global"},{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.sdkPayload.data","pt":"msg","to":"payload.config.encodedData","tot":"msg"},{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":920,"wires":[["7086ec61.e25d54"]]},{"id":"7086ec61.e25d54","type":"subflow:77241988.5609a8","z":"7780ff54.b10e1","name":"","env":[],"x":1100,"y":920,"wires":[["c8e95f87.5c001","130b4543.337adb"]]},{"id":"7e7bcf9d.e618f","type":"chatbot-conversation","z":"7780ff54.b10e1","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"","store":"","x":1050,"y":980,"wires":[["3d33c268.609a2e"]]},{"id":"3d33c268.609a2e","type":"function","z":"7780ff54.b10e1","name":"Uniswap Success Message","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nif(msg.payload.sdkPayload.error === undefined){\n    buttons = [];\n    buttons.push(button = {\n    \t\"type\": \"postback\",\n    \t\"label\": `Account`,\n    \t\"value\": `/account`,\n    \t\"style\": \"\"\n    });\n    buttons.push(button = {\n    \t\"type\": \"url\",\n    \t\"label\": `View on Etherscan`,\n    \t\"url\": `${global.get('ether_scan_url')}/tx/${msg.payload.sdkPayload.notification.hash}`,\n    \t\"style\": \"\"\n    });\n    \n    msg.payload.type = \"inline-buttons\";\n    msg.payload.content = `Congrats!!! SWAP transaction is initiated`;\n    msg.payload.buttons = buttons;\n    // msg.payload.content = `Congrats!!! SWAP transaction is initiated, verify on etherscan here ${global.get('ether_scan_url')}/tx/${msg.payload.sdkPayload.notification.hash}`;\n}else{\n    msg.payload.type = \"message\"\n    msg.payload.content = `${msg.payload.sdkPayload.error}`\n}\nreturn msg;","outputs":1,"noerr":0,"x":980,"y":1040,"wires":[["3648ecea.cb3884"]]},{"id":"3648ecea.cb3884","type":"chatbot-telegram-send","z":"7780ff54.b10e1","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1250,"y":1040,"wires":[]},{"id":"c8e95f87.5c001","type":"switch","z":"7780ff54.b10e1","name":"","property":"payload.sdkPayload.done","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":890,"y":980,"wires":[["7e7bcf9d.e618f"]]},{"id":"fe869000.50318","type":"debug","z":"7780ff54.b10e1","name":"Input: Swap","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":130,"y":780,"wires":[]},{"id":"cf49cdf2.7ce92","type":"subflow:6ee374ae.b9327c","z":"7780ff54.b10e1","name":"","env":[],"x":377,"y":858,"wires":[["b0ce7dc4.a9e2c"]]},{"id":"af2f077.7077af8","type":"chatbot-conversation","z":"7780ff54.b10e1","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"","store":"","x":290,"y":980,"wires":[["1d75bbb2.805414"]]},{"id":"1d75bbb2.805414","type":"function","z":"7780ff54.b10e1","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nmsg.payload.content = `You dont have enough eth to swap for C19 token\n\nETH balance:              ${msg.payload.balance}\nToken balance:            ${msg.payload.tokenBalance}\nAccount Address:  ${msg.payload.user.account.fields.account_address}\n`;\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":980,"wires":[["1332a60a.58996a"]]},{"id":"1332a60a.58996a","type":"chatbot-telegram-send","z":"7780ff54.b10e1","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":650,"y":980,"wires":[]},{"id":"a792eb54.0450a8","type":"chatbot-conversation","z":"7780ff54.b10e1","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"","store":"","x":670,"y":860,"wires":[["16db9545.e0292b"]]},{"id":"16db9545.e0292b","type":"function","z":"7780ff54.b10e1","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\n\nmsg.payload.type = \"message\";\nmsg.payload.content = `Please wait...\n`;\n\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":860,"wires":[["a4f3ca2b.d0e568"]]},{"id":"a4f3ca2b.d0e568","type":"chatbot-telegram-send","z":"7780ff54.b10e1","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1050,"y":860,"wires":[]},{"id":"130b4543.337adb","type":"debug","z":"7780ff54.b10e1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1290,"y":900,"wires":[]},{"id":"5e9237d3.773448","type":"comment","z":"7780ff54.b10e1","name":"Ask for token swap","info":"","x":210,"y":1360,"wires":[]},{"id":"4f1d2005.b9cb7","type":"subflow:6ee374ae.b9327c","z":"7780ff54.b10e1","name":"","env":[],"x":330,"y":1400,"wires":[["1d4d193e.713577","5b8bad7.c9ab554"]]},{"id":"64442cec.3223a4","type":"chatbot-telegram-send","z":"7780ff54.b10e1","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1370,"y":1300,"wires":[]},{"id":"fb4f8da0.31da6","type":"function","z":"7780ff54.b10e1","name":"Swap Button","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Swap ETH for C19 Tokens`,\n\t\"value\": `/swap`,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `\nIn order to swap please make sure you have enough ETH at address ${msg.payload.user.account.fields.account_address}\n\n♢ETH balance:              ${msg.payload.balance}\n🔆C19 balance:            ${msg.payload.tokenBalance}\n`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":1300,"wires":[["64442cec.3223a4"]]},{"id":"a72a8470.9baa78","type":"link in","z":"7780ff54.b10e1","name":"In: ETH and Token Balance","links":[],"x":135,"y":1400,"wires":[[]]},{"id":"a5d4fbf3.bde378","type":"switch","z":"7780ff54.b10e1","name":"","property":"payload.balance","propertyType":"msg","rules":[{"t":"gt","v":"gas_buffer","vt":"flow"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":1380,"wires":[["73922691.8feea8","6f182630.e4dc88"],["265ee24a.1ada4e"]]},{"id":"265ee24a.1ada4e","type":"debug","z":"7780ff54.b10e1","name":"Not Enough ETH","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":930,"y":1420,"wires":[]},{"id":"1d4d193e.713577","type":"debug","z":"7780ff54.b10e1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":410,"y":1360,"wires":[]},{"id":"73922691.8feea8","type":"debug","z":"7780ff54.b10e1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1300,"wires":[]},{"id":"5b8bad7.c9ab554","type":"switch","z":"7780ff54.b10e1","name":"","property":"payload.error","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":550,"y":1400,"wires":[["a5d4fbf3.bde378"],["3db5d698.012daa"]]},{"id":"3db5d698.012daa","type":"chatbot-conversation","z":"7780ff54.b10e1","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":290,"y":1460,"wires":[["97009b5e.84d588"]]},{"id":"97009b5e.84d588","type":"function","z":"7780ff54.b10e1","name":"","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\nbuttons = [];\n\n\nmsg.payload.type = \"message\";\nmsg.payload.content = msg.payload.error;\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":1460,"wires":[["e0317c95.2896c"]]},{"id":"e0317c95.2896c","type":"chatbot-telegram-send","z":"7780ff54.b10e1","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":630,"y":1460,"wires":[]},{"id":"6f182630.e4dc88","type":"chatbot-conversation","z":"7780ff54.b10e1","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":990,"y":1300,"wires":[["fb4f8da0.31da6"]]},{"id":"7304d11.2b7023","type":"comment","z":"c578ad64.4c8b1","name":"Donate","info":"","x":250,"y":2260,"wires":[]},{"id":"a3707197.0cecd","type":"comment","z":"c578ad64.4c8b1","name":"Transfer ETH to Address","info":"","x":330,"y":3020,"wires":[]},{"id":"7ba2bdc0.4a03a4","type":"chatbot-conversation","z":"5760092e.43a578","name":"","botDevelopment":"24145e37.52cb02","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":1770,"y":440,"wires":[["3ca85dc9.b952c2"]]},{"id":"3ca85dc9.b952c2","type":"function","z":"5760092e.43a578","name":"Token Deposit Success","func":"msg.payload.chatId = msg.payload.user.fields.chat_id;\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Account`,\n\t\"value\": `/account`,\n\t\"style\": \"\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Menu`,\n\t\"value\": `/menu`,\n\t\"style\": \"\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"newline\"\n});\n\nbuttons.push({\n\t\"type\": \"url\",\n\t\"label\": \"View Transaction\",\n\t\"url\": `${global.get('ether_scan_url')}/tx/${msg.payload.response.hash}`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\n\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `We've initiated transaction to add a membership token to your account.`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":2010,"y":440,"wires":[["f3255ab6.597d68"]]},{"id":"995ff4c8.e979c8","type":"debug","z":"5760092e.43a578","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":420,"wires":[]},{"id":"942b53a.bc671b","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":2475,"y":1720,"wires":[]},{"id":"88661831.6dbd78","type":"link out","z":"c578ad64.4c8b1","name":"Out: Delete Previous Message","links":["ce132d60.5c711","21ed2279.c42f3e"],"x":555,"y":2980,"wires":[]},{"id":"642845ca.b5289c","type":"link out","z":"c578ad64.4c8b1","name":"Out: Delete Previous Message","links":["ce132d60.5c711","21ed2279.c42f3e"],"x":1455,"y":3160,"wires":[]},{"id":"1397ac00.9f68c4","type":"link out","z":"c578ad64.4c8b1","name":"Out: Delete Previous Message","links":["ce132d60.5c711","21ed2279.c42f3e"],"x":935,"y":2420,"wires":[]},{"id":"cfbcf370.36904","type":"link out","z":"c578ad64.4c8b1","name":"Out: Delete Previous Message","links":["ce132d60.5c711","21ed2279.c42f3e"],"x":455,"y":2320,"wires":[]},{"id":"d51f2412.930648","type":"link out","z":"c578ad64.4c8b1","name":"Out: Delete Previous Message","links":["ce132d60.5c711","21ed2279.c42f3e"],"x":735,"y":320,"wires":[]},{"id":"92f64b11.182bd8","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1570,"y":360,"wires":[]},{"id":"127372ac.22097d","type":"function","z":"c578ad64.4c8b1","name":"Main Menu","func":"\nnotificationObj = {\n\t\"type\": \"postback\",\n\t\"label\": \"🔊 Enable Notifications\",\n\t\"value\": \"notification_on\",\n\t\"answer\": \"\",\n\t\"alert\": false,\n\t\"style\": \"\"\n}\n\n\nif(msg.payload.user.fields.notification === true){\n    notificationObj.label = '🔇 Disable Notifications'\n    notificationObj.value = \"notification_off\"\n}else{\n    \n}\n\nmsg.payload.type = 'inline-buttons'\nmsg.payload.name = 'Main Menu'\nmsg.payload.content = '*UNDER ACTIVE DEVELOPMENT*\\n\\nThanks for joining! Choose from the following options to interact with the Collab DAO and community!\\n\\n⛑️Membership - join and access members only features (vote, propose, and members chat)\\n\\n🙏 Donate to the Relief Fund - donate to add funds to be distributed to people and initiatives fighting Covid-19!\\n\\n🗣Chat - members only chat to discuss DAO proposals\\n\\n📜Community Forum - submit a project for funding and learn about the community guidelines\\n\\n💰Account - donate, upload, and withdraw ETH\\n\\n🤓Support - find technical support\\n\\n🕸️Website - find out more about Collab19\\n\\n📡Signal Proposal - first step in the proposal process, gather sentiment (submit a forum post to include in this submission)\\n\\n💸Funding Proposal - last step of the proposal process, submit for fundinng!\\n\\nClick the Membership button to gain C19 membership and access the MO features!'\nmsg.payload.buttons = [{\n\t\t\"type\": \"postback\",\n\t\t\"label\": \"⛑️Join Membership\",\n\t\t\"value\": \"/membership\",\n\t\t\"answer\": \"\",\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n\t}, {\n\t\t\"type\": \"newline\"\n\t}, {\n\t\t\"type\": \"postback\",\n\t\t\"label\": \"🙏 Donate to the Relief Fund\",\n\t\t\"value\": \"/donate\",\n\t\t\"answer\": \"\",\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n\t}, {\n\t\t\"type\": \"newline\"\n\t}, {\n\t\t\"type\": \"url\",\n\t\t\"label\": \"🗣Chat️ (MO)\",\n\t\t\"url\": \"https://t.me/joinchat/Hgw0mVX9sEY5JgZ21Qvkjw\",\n\t\t\"webViewHeightRatio\": \"tall\",\n\t\t\"extensions\": false,\n\t\t\"answer\": \"\",\n\t\t\"alert\": false\n\t},\n\t\n\t{\n\t\t\"type\": \"url\",\n\t\t\"label\": \"📜Community Forum\",\n\t\t\"url\": \"https://forum.collab19.live/t/collab19-orientation/15\",\n\t\t\"webViewHeightRatio\": \"tall\",\n\t\t\"extensions\": false,\n\t\t\"answer\": \"\",\n\t\t\"alert\": false\n\t}, {\n\t\t\"type\": \"newline\"\n\t}, {\n\t\t\"type\": \"url\",\n\t\t\"label\": \"🕸️Website \",\n\t\t\"url\": \"https://collab19.live/\",\n\t\t\"webViewHeightRatio\": \"tall\",\n\t\t\"extensions\": false,\n\t\t\"answer\": \"\",\n\t\t\"alert\": false\n\t}, {\n\t\t\"type\": \"url\",\n\t\t\"label\": \"🤓Support  \",\n\t\t\"url\": \"https://t.me/AbridgedEA\",\n\t\t\"webViewHeightRatio\": \"tall\",\n\t\t\"extensions\": false,\n\t\t\"answer\": \"\",\n\t\t\"alert\": false\n\t}, {\n\t\t\"type\": \"newline\"\n\t}, \n\t\n\tnotificationObj, \n\t{\n\t\t\"type\": \"postback\",\n\t\t\"label\": \"💰Account\",\n\t\t\"value\": \"/account\",\n\t\t\"answer\": \"\",\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n\t}, {\n\t\t\"type\": \"newline\"\n\t},\n\t{\n\t\t\"type\": \"postback\",\n\t\t\"label\": \"📡Signal Proposal (MO)\",\n\t\t\"value\": \"/signal\",\n\t\t\"answer\": \"\",\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n\t}, {\n\t\t\"type\": \"newline\"\n\t},\n\t{\n\t\t\"type\": \"postback\",\n\t\t\"label\": \"💸Funding Proposal (MO)\",\n\t\t\"value\": \"/fund\",\n\t\t\"answer\": \"\",\n\t\t\"alert\": false,\n\t\t\"style\": \"\"\n\t}]\n\t\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":960,"wires":[["615f680.3f69e98"]]},{"id":"54c787a9.313518","type":"chatbot-inline-buttons","z":"c578ad64.4c8b1","name":"Main menu","buttons":[{"type":"url","label":"🔆 DAO Interface","url":"https://mainnet.aragon.org/#/collab/home/","webViewHeightRatio":"tall","extensions":false,"answer":"","alert":false},{"type":"newline"},{"type":"postback","label":"🔊 Enable Notifications","value":"notifications","answer":"","alert":false,"style":""},{"type":"url","label":"🤗 Public Community","url":"https://t.me/joinchat/HcTaOxhr7mt9K7mBTMxlHw","webViewHeightRatio":"tall","extensions":false,"answer":"","alert":false},{"type":"newline"},{"type":"url","label":"📜 Info ","url":"https://www.collab19.live/","webViewHeightRatio":"tall","extensions":false,"answer":"","alert":false},{"type":"url","label":"💪 Support  ","url":"https://t.me/AbridgedEA","webViewHeightRatio":"tall","extensions":false,"answer":"","alert":false},{"type":"newline"},{"type":"url","label":"Tokehholders Chat 🗣️","url":"https://t.me/joinchat/Hgw0mRy5uH3dDELcTSoeMw","webViewHeightRatio":"tall","extensions":false,"answer":"","alert":false},{"type":"postback","label":"💰Account","value":"/account","answer":"","alert":false,"style":""}],"message":"*UNDER ACTIVE DEVELOPMENT*\n\nThanks for joining! You now have access to propose how the community will spend funds available.\n\nChoose from the following options to further interact with the Collab DAO and community!","x":1753,"y":709,"wires":[[]]},{"id":"914af5b0.6afcc8","type":"function","z":"c578ad64.4c8b1","name":"Update notification","func":"notification = msg.payload.content === 'notification_on' ? true : false\nmsg.payload.payload = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"notification\": notification\n        }\n    }\n]\nreturn msg;","outputs":1,"noerr":0,"x":1630,"y":780,"wires":[["82db2a8f.2999a8"]]},{"id":"82db2a8f.2999a8","type":"node-airtable","z":"c578ad64.4c8b1","name":"Update User","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.user","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.record","x":1830,"y":780,"wires":[[],[]]},{"id":"3a425854.6cdad8","type":"link out","z":"c578ad64.4c8b1","name":"Out: New Proposal","links":["eb61f6a8.064e78"],"x":1355,"y":880,"wires":[]},{"id":"eb61f6a8.064e78","type":"link in","z":"c578ad64.4c8b1","name":"In: New Proposal","links":["3a425854.6cdad8"],"x":155,"y":1160,"wires":[["287e39f3.938116"]]},{"id":"287e39f3.938116","type":"function","z":"c578ad64.4c8b1","name":"New proposal message","func":"msg.payload.content = `Format: <title> <forum link> \n\nFind more information in the Creating Proposals post here: https://forum.collab19.live/t/proposal-guidelines/16 (Max 25 char)\n\nHit /menu to cancel.\n`\nmsg.payload.type = 'buttons';\nmsg.payload.buttons = [{\n\t\"type\": \"keyboardButton\",\n\t\"label\": \"Main Menu\"\n}]\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1160,"wires":[["eeb5fa5b.65f318"]]},{"id":"eeb5fa5b.65f318","type":"chatbot-telegram-send","z":"c578ad64.4c8b1","bot":"24145e37.52cb02","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":650,"y":1160,"wires":[["16db1a95.800275","f2443a08.8bd9e8"]]},{"id":"79fd897e.f25588","type":"function","z":"c578ad64.4c8b1","name":"New proposal user's data","func":"temp = msg.payload.content;\n\nif(temp.length > 25){\n    temp = temp.substring(0,25);\n}\n\nmsg.payload.proposalData = temp\n\nreturn msg;","outputs":1,"noerr":0,"x":1070,"y":1160,"wires":[["256dd365.266a1c"]]},{"id":"256dd365.266a1c","type":"link out","z":"c578ad64.4c8b1","name":"Out: Add Proposal","links":["c0929ec1.6b1ba"],"x":1275,"y":1160,"wires":[]},{"id":"16db1a95.800275","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":1220,"wires":[]},{"id":"d7e53dc8.cff68","type":"comment","z":"59ce305.9861dd","name":"Create New  Voting Proposal","info":"","x":480,"y":900,"wires":[]},{"id":"af0d9edc.b8a4b","type":"link out","z":"c578ad64.4c8b1","name":"Out: User Action","links":["821f2a8.609a6d8","4999a322.e67ebc"],"x":1435,"y":900,"wires":[]},{"id":"3f09ca90.83a1b6","type":"debug","z":"59ce305.9861dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2190,"y":460,"wires":[]},{"id":"ade53e7c.145f","type":"comment","z":"59ce305.9861dd","name":"Voteing Flow","info":"","x":510,"y":420,"wires":[]},{"id":"75bf07cf.31b5b8","type":"link out","z":"59ce305.9861dd","name":"","links":["24179a2b.532c16"],"x":1295,"y":540,"wires":[]},{"id":"e333cc76.f0001","type":"link out","z":"59ce305.9861dd","name":"","links":["24179a2b.532c16"],"x":1315,"y":1000,"wires":[]},{"id":"27beab63.3c9894","type":"link out","z":"59ce305.9861dd","name":"","links":["24179a2b.532c16"],"x":2195,"y":1020,"wires":[]},{"id":"8fbdf496.d22598","type":"link out","z":"59ce305.9861dd","name":"","links":["24179a2b.532c16"],"x":2055,"y":520,"wires":[]},{"id":"f3255ab6.597d68","type":"link out","z":"5760092e.43a578","name":"","links":["24179a2b.532c16"],"x":2195,"y":440,"wires":[]},{"id":"bce18f81.355e1","type":"link out","z":"c578ad64.4c8b1","name":"","links":["f957e9c9.d6cd48"],"x":335,"y":560,"wires":[]},{"id":"edfab344.8e88c","type":"link out","z":"59ce305.9861dd","name":"","links":["f957e9c9.d6cd48"],"x":775,"y":900,"wires":[]},{"id":"24ca40ec.7ddef","type":"link out","z":"59ce305.9861dd","name":"","links":["f957e9c9.d6cd48"],"x":1695,"y":820,"wires":[]},{"id":"1f1045ad.2294da","type":"link out","z":"59ce305.9861dd","name":"","links":["f957e9c9.d6cd48"],"x":635,"y":400,"wires":[]},{"id":"977dfd59.b84de","type":"link out","z":"59ce305.9861dd","name":"","links":["f957e9c9.d6cd48"],"x":1535,"y":320,"wires":[]},{"id":"5843cda1.041eb4","type":"debug","z":"5760092e.43a578","name":"Token trf error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1500,"y":540,"wires":[]},{"id":"f138667c.1b29a8","type":"link out","z":"5760092e.43a578","name":"","links":["24179a2b.532c16"],"x":1715,"y":520,"wires":[]},{"id":"f956e4a0.60e108","type":"subflow:e76f3c6.e434dc","z":"c578ad64.4c8b1","name":"","env":[],"x":1800,"y":860,"wires":[]},{"id":"f81405e0.fcf258","type":"function","z":"c578ad64.4c8b1","name":"","func":"msg.payload.chat_id = msg.payload.chatId;\nmsg.payload.message_id = msg.originalMessage.message_id - 1;\nreturn msg;","outputs":1,"noerr":0,"x":1580,"y":860,"wires":[["f956e4a0.60e108"]]},{"id":"2ffc0e5e.4de2f2","type":"subflow:e76f3c6.e434dc","z":"c578ad64.4c8b1","name":"","env":[],"x":940,"y":380,"wires":[]},{"id":"6a5db0.0411725","type":"function","z":"c578ad64.4c8b1","name":"","func":"msg.payload.chat_id = msg.payload.chatId;\nmsg.payload.message_id = msg.originalMessage.message_id - 1;\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":380,"wires":[["2ffc0e5e.4de2f2"]]},{"id":"f61113b3.189e","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/start","vt":"str"},{"t":"istype","v":"json","vt":"json"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":410,"y":380,"wires":[[],[],["93f71f2f.b071e"]]},{"id":"f2443a08.8bd9e8","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/cancel","vt":"str"},{"t":"eq","v":"Main Menu","vt":"str"},{"t":"eq","v":"/menu","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":850,"y":1160,"wires":[["ac385bcf.d6d258"],["ac385bcf.d6d258"],["ac385bcf.d6d258"],["79fd897e.f25588"]]},{"id":"93f71f2f.b071e","type":"delay","z":"c578ad64.4c8b1","name":"","pauseType":"delay","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":590,"y":380,"wires":[["6a5db0.0411725","d51f2412.930648"]]},{"id":"fce77b3a.abf648","type":"switch","z":"42aaf2dc.18badc","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"message","vt":"str"},{"t":"eq","v":"event","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":470,"y":380,"wires":[["b7651821.90be88"],["63390e18.ef826"],[]]},{"id":"63390e18.ef826","type":"switch","z":"42aaf2dc.18badc","name":"","property":"payload.eventType","propertyType":"msg","rules":[{"t":"eq","v":"new-user","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":610,"y":420,"wires":[["1cc39d07.1e8c03"],[]]},{"id":"1cc39d07.1e8c03","type":"link out","z":"42aaf2dc.18badc","name":"Out: New User Event","links":["68ac9c2f.43b4f4"],"x":735,"y":420,"wires":[]},{"id":"68ac9c2f.43b4f4","type":"link in","z":"a16cb33.84f085","name":"In: New User Event","links":["1cc39d07.1e8c03"],"x":180,"y":300,"wires":[["27fc0f46.89e5c"]]},{"id":"1cfcfed2.0a8ea1","type":"node-airtable","z":"a16cb33.84f085","name":"Get User","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"list","filter":"payload.filter","filterType":"msg","record":"","recordType":"msg","records":"","recordsType":"msg","output":"payload.users","x":460,"y":300,"wires":[["6d4b4632.c8f278"],[]]},{"id":"6d4b4632.c8f278","type":"change","z":"a16cb33.84f085","name":"","rules":[{"t":"set","p":"payload.user","pt":"msg","to":"payload.users[0]","tot":"msg"},{"t":"delete","p":"payload.users","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":300,"wires":[["e86ffb33.c88628"]]},{"id":"e86ffb33.c88628","type":"switch","z":"a16cb33.84f085","name":"","property":"payload.user","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":850,"y":300,"wires":[["d81af42f.3ab438","8f4f1474.c4cef8"],["aca7e6a6.d61c28","288e4e6f.9547b2"]]},{"id":"27fc0f46.89e5c","type":"function","z":"a16cb33.84f085","name":"","func":"msg.payload.filter = `({user_id} = '${msg.payload.userId.toString()}')`;\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":300,"wires":[["1cfcfed2.0a8ea1"]]},{"id":"d81af42f.3ab438","type":"debug","z":"a16cb33.84f085","name":"Kick user out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1070,"y":260,"wires":[]},{"id":"aca7e6a6.d61c28","type":"debug","z":"a16cb33.84f085","name":"Check for token balance","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1110,"y":320,"wires":[]},{"id":"2d526eb4.b13a22","type":"switch","z":"a16cb33.84f085","name":"","property":"records.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"str"},{"t":"nempty"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":620,"wires":[["df7b7184.9a339"],[]]},{"id":"a661584f.82bff8","type":"node-airtable","z":"a16cb33.84f085","name":"List Active Users","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"list","filter":"({status} = 'active')","filterType":"str","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"records","x":650,"y":600,"wires":[["2d526eb4.b13a22","fb0ed4c.48cef28"],[]]},{"id":"417a1d95.516394","type":"function","z":"a16cb33.84f085","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":680,"wires":[["df7b7184.9a339","25faff3d.c97b6"]]},{"id":"eb669a19.0ff218","type":"delay","z":"a16cb33.84f085","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1010,"y":680,"wires":[["417a1d95.516394"]]},{"id":"fb0ed4c.48cef28","type":"debug","z":"a16cb33.84f085","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":810,"y":560,"wires":[]},{"id":"12f745ed.2f8a5a","type":"link out","z":"a16cb33.84f085","name":"","links":["2bc385fe.0e3d2a"],"x":1495,"y":680,"wires":[]},{"id":"df7b7184.9a339","type":"array-loop","z":"a16cb33.84f085","name":"","key":"123","keyType":"msg","reset":false,"resetValue":"value-null","array":"records","arrayType":"msg","x":1030,"y":620,"wires":[["33c95607.f2238a"],["eb669a19.0ff218"]]},{"id":"93b0d8a.6583128","type":"function","z":"a16cb33.84f085","name":"Token address cache","func":"tokenAddress = flow.get('token_address');\nif(tokenAddress === undefined){\n    tokenAddress = {};\n}\nflow.set('token_address', tokenAddress);\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":600,"wires":[["a661584f.82bff8"]]},{"id":"3960b5df.07e52a","type":"function","z":"a16cb33.84f085","name":"Token address cache","func":"tokenAddress = flow.get('token_address');\ntokenAddress = {};\nflow.set('token_address', tokenAddress);\nreturn msg;","outputs":1,"noerr":0,"x":1400,"y":600,"wires":[[]]},{"id":"33c95607.f2238a","type":"delay","z":"a16cb33.84f085","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1200,"y":600,"wires":[["3960b5df.07e52a"]]},{"id":"4796789b.37a5b8","type":"comment","z":"a16cb33.84f085","name":"Runs every 5 mins","info":"","x":230,"y":540,"wires":[]},{"id":"fe8ddb15.a71188","type":"inject","z":"a16cb33.84f085","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"300","crontab":"","once":true,"onceDelay":"3","x":210,"y":580,"wires":[["93b0d8a.6583128"]]},{"id":"18f40b36.b07e15","type":"inject","z":"a16cb33.84f085","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"2","x":210,"y":620,"wires":[[]]},{"id":"cdaae40a.1b70a8","type":"node-airtable","z":"a16cb33.84f085","name":"Get Account","auth":"7ecc84ea.f9cb2c","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":410,"y":1080,"wires":[["40fd5d4d.e7a1a4"],["94976f42.203e7"]]},{"id":"2bc385fe.0e3d2a","type":"link in","z":"a16cb33.84f085","name":"","links":["12f745ed.2f8a5a","288e4e6f.9547b2"],"x":235,"y":1080,"wires":[["cdaae40a.1b70a8"]]},{"id":"40fd5d4d.e7a1a4","type":"change","z":"a16cb33.84f085","name":"","rules":[{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"},{"t":"set","p":"payload.address_contract","pt":"msg","to":"address_c19_token","tot":"global"},{"t":"set","p":"payload.abi","pt":"msg","to":"abi_erc20","tot":"global"},{"t":"set","p":"payload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"},{"t":"set","p":"payload.userId","pt":"msg","to":"payload.user.fields.user_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":1040,"wires":[["2673069b.75643a"]]},{"id":"2673069b.75643a","type":"subflow:5667a237.c07e7c","z":"a16cb33.84f085","name":"","env":[],"x":860,"y":1040,"wires":[["f1ff128b.8b201"]]},{"id":"71f3ca2f.895194","type":"function","z":"92ad2621.544c88","name":"","func":"const Telegram = global.get('telegram');\nconst token = msg.payload.token;\n\nconst telegram = new Telegram(token, {\n  agent: null,        // https.Agent instance, allows custom proxy, certificate, keep alive, etc.\n  webhookReply: true  // Reply via webhook\n})\n\nasync function getChatMember() {\n    try{\n    const result = await telegram.kickChatMember(msg.payload.chatId, msg.payload.userId);\n        msg.payload.result = result;\n        node.send(msg);\n        node.done();\n    }catch(error){\n        msg.payload.error = error;\n        node.send(msg);\n        node.done();\n    }\n    \n}\n\ngetChatMember();\n\n\nreturn","outputs":1,"noerr":0,"x":510,"y":320,"wires":[[]]},{"id":"c5b20d24.a0228","type":"debug","z":"92ad2621.544c88","name":"Kick Chat Member","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":510,"y":380,"wires":[]},{"id":"f1ff128b.8b201","type":"switch","z":"a16cb33.84f085","name":"","property":"payload.tokenBalance","propertyType":"msg","rules":[{"t":"gte","v":"0.5","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1050,"y":1040,"wires":[["4aace5ab.454b8c"],["94976f42.203e7"]]},{"id":"94976f42.203e7","type":"change","z":"a16cb33.84f085","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_telegram_bot","tot":"global"},{"t":"set","p":"payload.chatId","pt":"msg","to":"group_chat_id","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":1100,"wires":[["66537922.9c9438","f7e91125.0ad3e"]]},{"id":"f7e91125.0ad3e","type":"subflow:92ad2621.544c88","z":"a16cb33.84f085","name":"","env":[],"x":1050,"y":1100,"wires":[["a2c60d3.9a31ff","2b7737ae.38fa38"]]},{"id":"a2c60d3.9a31ff","type":"debug","z":"a16cb33.84f085","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1070,"y":1140,"wires":[]},{"id":"2b7737ae.38fa38","type":"switch","z":"a16cb33.84f085","name":"","property":"payload.result","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1270,"y":1100,"wires":[["71d64c7b.f2e494","6713008d.297ba"],["71d64c7b.f2e494"]]},{"id":"6713008d.297ba","type":"function","z":"a16cb33.84f085","name":"Set banned","func":"\nmsg.payload.record = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"status\":\"banned\"\n        }\n    }\n]\n\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":1080,"wires":[["2317366c.81cc8a"]]},{"id":"71d64c7b.f2e494","type":"debug","z":"a16cb33.84f085","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1470,"y":1120,"wires":[]},{"id":"2317366c.81cc8a","type":"node-airtable","z":"a16cb33.84f085","name":"Upate user table","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.record","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.result","x":1660,"y":1080,"wires":[[],[]]},{"id":"d445470d.33e398","type":"debug","z":"a16cb33.84f085","name":"Group Manager: Token Balance","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":970,"y":980,"wires":[]},{"id":"66537922.9c9438","type":"debug","z":"a16cb33.84f085","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":1140,"wires":[]},{"id":"ddde60df.b2316","type":"debug","z":"a16cb33.84f085","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":410,"y":1020,"wires":[]},{"id":"25faff3d.c97b6","type":"change","z":"a16cb33.84f085","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.user","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1370,"y":680,"wires":[["12f745ed.2f8a5a"]]},{"id":"909fbed1.e61a9","type":"link in","z":"a16cb33.84f085","name":"","links":["8f4f1474.c4cef8"],"x":675,"y":1140,"wires":[["94976f42.203e7"]]},{"id":"8f4f1474.c4cef8","type":"link out","z":"a16cb33.84f085","name":"","links":["909fbed1.e61a9"],"x":995,"y":220,"wires":[]},{"id":"288e4e6f.9547b2","type":"link out","z":"a16cb33.84f085","name":"","links":["2bc385fe.0e3d2a"],"x":975,"y":360,"wires":[]},{"id":"b7651821.90be88","type":"switch","z":"42aaf2dc.18badc","name":"","property":"originalMessage.chat.type","propertyType":"msg","rules":[{"t":"eq","v":"private","vt":"str"},{"t":"eq","v":"supergroup","vt":"str"},{"t":"eq","v":"group","vt":"str"},{"t":"eq","v":"otherwise","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":670,"y":340,"wires":[["f0a93ae3.e17148"],[],[],[]]},{"id":"4aace5ab.454b8c","type":"function","z":"a16cb33.84f085","name":"Set Active if not","func":"if(msg.payload.user.fields.status !== 'active'){\n    msg.payload.record = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"status\":\"active\"\n        }\n    }\n    ]\n    return msg;\n}\nreturn;\n","outputs":1,"noerr":0,"x":1240,"y":1020,"wires":[["5a08ed50.28d374"]]},{"id":"5a08ed50.28d374","type":"node-airtable","z":"a16cb33.84f085","name":"Upate user table","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.record","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.result","x":1440,"y":1020,"wires":[[],[]]},{"id":"a2f26765.09dd18","type":"function","z":"e76f3c6.e434dc","name":"Delete Message","func":"const Telegram = global.get('telegram');\nconst token = msg.payload.token;\n\nconst telegram = new Telegram(token, {\n  agent: null,        // https.Agent instance, allows custom proxy, certificate, keep alive, etc.\n  webhookReply: true  // Reply via webhook\n})\n\nasync function deleteMessage() {\n    try{\n    const result = await telegram.deleteMessage(msg.payload.chatId, msg.payload.message_id);\n        msg.payload.result = result;\n        node.send(msg);\n        node.done();\n    }catch(error){\n        msg.payload.error = error;\n        node.send(msg);\n        node.done();\n    }\n    \n}\n\ndeleteMessage();\n\n\nreturn","outputs":1,"noerr":0,"x":520,"y":180,"wires":[[]]},{"id":"97746cdf.85c0d","type":"change","z":"e76f3c6.e434dc","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_telegram_bot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":180,"wires":[["a2f26765.09dd18"]]},{"id":"4827b6fb.fb2788","type":"inject","z":"a16cb33.84f085","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":1660,"wires":[["d63d9a5.5374968"]]},{"id":"d63d9a5.5374968","type":"change","z":"a16cb33.84f085","name":"","rules":[{"t":"set","p":"payload.userId","pt":"msg","to":"531448013","tot":"str"},{"t":"set","p":"payload.chatId","pt":"msg","to":"group_chat_id","tot":"global"},{"t":"set","p":"payload.token","pt":"msg","to":"token_telegram_bot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":1660,"wires":[["257a02c1.57246e"]]},{"id":"257a02c1.57246e","type":"function","z":"a16cb33.84f085","name":"","func":"const Telegram = global.get('telegram');\nconst token = msg.payload.token;\n\nconst telegram = new Telegram(token, {\n  agent: null,        // https.Agent instance, allows custom proxy, certificate, keep alive, etc.\n  webhookReply: true  // Reply via webhook\n})\n\nasync function getChatMember() {\n    try{\n    const result = await telegram.unbanChatMember(msg.payload.chatId, msg.payload.userId);\n        msg.payload.result = result;\n        node.send(msg);\n        node.done();\n    }catch(error){\n        msg.payload.error = error;\n        node.send(msg);\n        node.done();\n    }\n    \n}\n\ngetChatMember();\n\n\nreturn","outputs":1,"noerr":0,"x":770,"y":1640,"wires":[["2843456.39722ba"]]},{"id":"2843456.39722ba","type":"debug","z":"a16cb33.84f085","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":1640,"wires":[]},{"id":"8c120d58.4c3e6","type":"link in","z":"a16cb33.84f085","name":"In: Unban User","links":["b15cf67f.e3b328"],"x":275,"y":1580,"wires":[["f226b39e.de85c"]]},{"id":"b15cf67f.e3b328","type":"link out","z":"c578ad64.4c8b1","name":"Out: Unban user","links":["8c120d58.4c3e6"],"x":1055,"y":680,"wires":[]},{"id":"f226b39e.de85c","type":"switch","z":"a16cb33.84f085","name":"","property":"payload.user.fields.status","propertyType":"msg","rules":[{"t":"eq","v":"banned","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":1580,"wires":[["4156f405.17c9cc"],[]]},{"id":"4156f405.17c9cc","type":"change","z":"a16cb33.84f085","name":"","rules":[{"t":"set","p":"payload.chatId","pt":"msg","to":"group_chat_id","tot":"global"},{"t":"set","p":"payload.token","pt":"msg","to":"token_telegram_bot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1580,"wires":[["257a02c1.57246e"]]},{"id":"9cb68a5f.f07248","type":"chatbot-message","z":"c578ad64.4c8b1","name":"/fund Coming Soon!","message":[{"message":"Coming Soon!\n/menu"}],"language":"","x":1700,"y":920,"wires":[["615f680.3f69e98"]]},{"id":"a4a126f2.ddcbc8","type":"link in","z":"c578ad64.4c8b1","name":"In: Membership Prep","links":["a5a06dcf.d85ef"],"x":155,"y":1380,"wires":[["e6bf95bd.698ac8"]]},{"id":"e6bf95bd.698ac8","type":"function","z":"c578ad64.4c8b1","name":"Membership Prep","func":"buttons = [];\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": \"Continue\",\n\t\"value\": \"/addeth\",\n\t\"answer\": \"\",\n\t\"alert\": false,\n\t\"style\": \"\"\n    }, {\n\t\t\"type\": \"url\",\n\t\t\"label\": \"Learn More\",\n\t\t\"url\": \"https://collab19.live/\",\n\t\t\"webViewHeightRatio\": \"tall\",\n\t\t\"extensions\": false,\n\t\t\"answer\": \"\",\n\t\t\"alert\": false\n\t})\n\nmsg.payload.type = \"inline-buttons\";\ntokenBalance = msg.payload.tokenBalance === undefined ? 0 : msg.payload.tokenBalance;\n\n\nmsg.payload.content = `\nThe next screen will give you the option to purchase ethereum (ETH) or send some to your wallet.\n\nOnce funded, your account will recieve the DAO membership token (C19).\n\nBoth are needed to participate in DAO decision-making.\n\nOnce onboarded, please follow on to the 'Donate' button to give some of the uploaded value (suggested $5 USD donation).\n`;\n\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1380,"wires":[["a2e73bc4.4edce8"]]},{"id":"a5a06dcf.d85ef","type":"link out","z":"c578ad64.4c8b1","name":"Out: Membership Prep","links":["a4a126f2.ddcbc8"],"x":1275,"y":960,"wires":[]},{"id":"a2e73bc4.4edce8","type":"chatbot-telegram-send","z":"c578ad64.4c8b1","bot":"24145e37.52cb02","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":570,"y":1380,"wires":[]},{"id":"5bd9ceb9.e15ca","type":"link out","z":"c578ad64.4c8b1","name":"Fund","links":["102035d3.2d580a"],"x":1355,"y":920,"wires":[]},{"id":"102035d3.2d580a","type":"link in","z":"c578ad64.4c8b1","name":"In: Fund","links":["5bd9ceb9.e15ca"],"x":1535,"y":920,"wires":[["9cb68a5f.f07248"]]},{"id":"ac385bcf.d6d258","type":"link out","z":"c578ad64.4c8b1","name":"Outt: Trf to input node","links":["f6288c94.6b50c"],"x":975,"y":1100,"wires":[]},{"id":"f6288c94.6b50c","type":"link in","z":"42aaf2dc.18badc","name":"In: Recursive Node","links":["ac385bcf.d6d258","5c82006a.bce12","ad440564.892f58"],"x":555,"y":280,"wires":[["b7651821.90be88"]]},{"id":"9fa6098b.ce41b8","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/cancel","vt":"str"},{"t":"eq","v":"Main Menu","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":690,"y":3080,"wires":[["5c82006a.bce12"],["5c82006a.bce12"],["42f4d01a.45158"]]},{"id":"5c82006a.bce12","type":"link out","z":"c578ad64.4c8b1","name":"Outt: Trf to input node","links":["f6288c94.6b50c"],"x":815,"y":3020,"wires":[]},{"id":"43dd3302.aed98c","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/cancel","vt":"str"},{"t":"eq","v":"Main Menu","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":590,"y":2280,"wires":[["ad440564.892f58"],["ad440564.892f58"],["a1eae70d.97beb8"]]},{"id":"ad440564.892f58","type":"link out","z":"c578ad64.4c8b1","name":"Outt: Trf to input node","links":["f6288c94.6b50c"],"x":715,"y":2220,"wires":[]},{"id":"15fb23f7.aecabc","type":"function","z":"5eb31f33.09c03","name":"","func":"awsClientNode = global.get('aws_client_node');\nAWS = global.get('AWS');\nvar env = global.get('env');\n\nAWS.config.accessKeyId = env.AWS_ACCESS_KEY_ID\nAWS.config.secretAccessKey = env.AWS_SECREAT_ACCESS_KEY\n\nconst { KmsKeyringNode, encrypt, decrypt } = awsClientNode\n/* Start by constructing a keyring. We'll create a KMS keyring.\n * Specify an AWS Key Management Service (AWS KMS) customer master key (CMK) to be the\n * generator key in the keyring. This CMK generates a data key and encrypts it. \n * To use the keyring to encrypt data, you need kms:GenerateDataKey permission \n * on this CMK. To decrypt, you need kms:Decrypt permission. \n */\nconst generatorKeyId = env.KMS_GENERATOR_KEY_ID\n\n/* You can specify additional CMKs for the keyring. The data key that the generator key\n * creates is also encrypted by the additional CMKs you specify. To encrypt data, \n *  you need kms:Encrypt permission on this CMK. To decrypt, you need kms:Decrypt permission.\n */\nconst keyIds = [env.KMS_KEY_ID]\n\n/* Create the KMS keyring */\nconst keyring = new KmsKeyringNode({ generatorKeyId, keyIds })\n\n/* Set an encryption context For more information: \n * https://docs.aws.amazon.com/encryption-sdk/latest/developer-guide/concepts.html#encryption-context\n */\nconst context = {\n    stage: 'prod',\n    purpose: 'encrypt pks',\n    origin: 'us-east-2'\n}\n\n\nasync function encryptKey(cleartext) {\n    try{\n        const { result } = await encrypt(keyring, cleartext, { context })\n        msg.payload.encryptedData = JSON.stringify(result)\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg);\n    node.done();\n}\n\nasync function decryptKey(encryptedData) {\n    try{\n        const { plaintext, messageHeader } = await decrypt(keyring, encryptedData)\n        msg.payload.decryptedData = String.fromCharCode.apply(null, plaintext);\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg);\n    node.done();\n   \n}\n\nif(msg.payload.action === 'ENCRYPT'){\n    encryptKey(msg.payload.data);\n}else if(msg.payload.action === 'DECRYPT'){\n    json = JSON.parse(msg.payload.data);\n    var buf = Buffer.from(json.data);\n    decryptKey(buf);\n}\n\nreturn;","outputs":1,"noerr":0,"x":410,"y":360,"wires":[[]]},{"id":"47ca77ff.a24fe8","type":"inject","z":"5eb31f33.09c03","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":480,"wires":[[]]},{"id":"60239c64.c59f24","type":"debug","z":"5eb31f33.09c03","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":200,"wires":[]},{"id":"3418ba28.ae6be6","type":"subflow:5eb31f33.09c03","z":"c578ad64.4c8b1","name":"","env":[],"x":1900,"y":500,"wires":[["4240ca02.327744"]]},{"id":"2d41ecf3.c87f54","type":"change","z":"c578ad64.4c8b1","name":"Encrypt PK","rules":[{"t":"set","p":"payload.action","pt":"msg","to":"ENCRYPT","tot":"str"},{"t":"set","p":"payload.data","pt":"msg","to":"payload.sdkPayload.privateKey","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1710,"y":500,"wires":[["3418ba28.ae6be6"]]},{"id":"ca7659a6.939148","type":"debug","z":"c578ad64.4c8b1","name":"Error During Exceptation","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1810,"y":620,"wires":[]},{"id":"39e11ca.50104e4","type":"change","z":"f7fef601.4cba58","name":"","rules":[{"t":"set","p":"payload.action","pt":"msg","to":"DECRYPT","tot":"str"},{"t":"set","p":"payload.data","pt":"msg","to":"payload.user.account.fields.pk","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":280,"wires":[["97165cbe.65c9e"]]},{"id":"97165cbe.65c9e","type":"subflow:5eb31f33.09c03","z":"f7fef601.4cba58","name":"","env":[],"x":760,"y":280,"wires":[["f18a2eca.12c98"]]},{"id":"f18a2eca.12c98","type":"change","z":"f7fef601.4cba58","name":"","rules":[{"t":"set","p":"payload.user.account.fields.pk","pt":"msg","to":"payload.decryptedData","tot":"msg"},{"t":"delete","p":"payload.action","pt":"msg"},{"t":"delete","p":"payload.decryptedData","pt":"msg"},{"t":"delete","p":"payload.data","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":280,"wires":[[]]},{"id":"4300dc4b.f639b4","type":"subflow:f7fef601.4cba58","z":"59ce305.9861dd","name":"","x":1550,"y":480,"wires":[["3ded40a3.78569"]]},{"id":"418cb1e6.caa7b","type":"debug","z":"c578ad64.4c8b1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1020,"y":2100,"wires":[]},{"id":"b344c363.de1a7","type":"subflow:f7fef601.4cba58","z":"59ce305.9861dd","name":"","x":1670,"y":960,"wires":[["607b5634.027208"]]},{"id":"5e489559.a2f48c","type":"subflow:f7fef601.4cba58","z":"c578ad64.4c8b1","name":"","x":1210,"y":2700,"wires":[["ef5332f0.aac0c"]]},{"id":"90ba9c9.060716","type":"subflow:f7fef601.4cba58","z":"c578ad64.4c8b1","name":"","env":[],"x":610,"y":2020,"wires":[["750a72ce.64dd0c"]]},{"id":"f1e1394d.527bb8","type":"switch","z":"f7fef601.4cba58","name":"","property":"payload.user.account.fields.pk","propertyType":"msg","rules":[{"t":"istype","v":"json","vt":"json"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":320,"wires":[["39e11ca.50104e4"],[]]},{"id":"cffdfe9.1d666","type":"switch","z":"c578ad64.4c8b1","name":"","property":"payload.balance","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1050,"y":1500,"wires":[["727a44fa.5a502c"],[]]},{"id":"203b1f7b.c2b41","type":"link out","z":"c578ad64.4c8b1","name":"","links":["1b4c8156.ebabaf"],"x":1355,"y":1460,"wires":[]},{"id":"2ea739fb.106246","type":"debug","z":"c578ad64.4c8b1","name":"Already Tried","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1410,"y":1500,"wires":[]},{"id":"727a44fa.5a502c","type":"function","z":"c578ad64.4c8b1","name":"","func":"posted = flow.get(msg.payload.userId.toString());\nif(posted === undefined){\n    flow.set(msg.payload.userId.toString(), true);\n    return [msg, null]\n}\nreturn [null, msg ] ;","outputs":2,"noerr":0,"x":1210,"y":1500,"wires":[["203b1f7b.c2b41"],["2ea739fb.106246"]]},{"id":"6fe46667.0285b8","type":"comment","z":"a16cb33.84f085","name":"Unban user","info":"","x":330,"y":1520,"wires":[]},{"id":"21ed2279.c42f3e","type":"link in","z":"d7821d16.12614","name":"In: Delete Previous Message","links":["68af27fc.4d9758","88661831.6dbd78","642845ca.b5289c","1397ac00.9f68c4","cfbcf370.36904","d51f2412.930648"],"x":215,"y":500,"wires":[["397e38ef.b539b8"]]},{"id":"397e38ef.b539b8","type":"change","z":"d7821d16.12614","name":"","rules":[{"t":"set","p":"payload.chat_id","pt":"msg","to":"payload.chatId","tot":"msg"},{"t":"set","p":"payload.message_id","pt":"msg","to":"originalMessage.message_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":500,"wires":[["2299b074.f2b39"]]},{"id":"2299b074.f2b39","type":"subflow:e76f3c6.e434dc","z":"d7821d16.12614","name":"","env":[],"x":600,"y":500,"wires":[]},{"id":"33311652.79f54a","type":"inject","z":"7780ff54.b10e1","name":"Uniswap Factry ABI","topic":"","payload":"[{\"name\":\"NewExchange\",\"inputs\":[{\"type\":\"address\",\"name\":\"token\",\"indexed\":true},{\"type\":\"address\",\"name\":\"exchange\",\"indexed\":true}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"initializeFactory\",\"outputs\":[],\"inputs\":[{\"type\":\"address\",\"name\":\"template\"}],\"constant\":false,\"payable\":false,\"type\":\"function\",\"gas\":35725},{\"name\":\"createExchange\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"token\"}],\"constant\":false,\"payable\":false,\"type\":\"function\",\"gas\":187911},{\"name\":\"getExchange\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"token\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":715},{\"name\":\"getToken\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"exchange\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":745},{\"name\":\"getTokenWithId\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"uint256\",\"name\":\"token_id\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":736},{\"name\":\"exchangeTemplate\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":633},{\"name\":\"tokenCount\",\"outputs\":[{\"type\":\"uint256\",\"name\":\"out\"}],\"inputs\":[],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":663}]","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":480,"y":60,"wires":[["64b446ea.d51bd8"]]},{"id":"64b446ea.d51bd8","type":"json","z":"7780ff54.b10e1","name":"","property":"payload","action":"obj","pretty":false,"x":710,"y":60,"wires":[["1a3a509c.641d9f"]]},{"id":"1a3a509c.641d9f","type":"change","z":"7780ff54.b10e1","name":"Abi Uniswap: Factory","rules":[{"t":"set","p":"abi_uniswap_exchange_factory","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":60,"wires":[[]]},{"id":"2d62cf9.ad3563","type":"inject","z":"7780ff54.b10e1","name":"Abi Uniswap Exchange","topic":"","payload":"[{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"min_liquidity\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"addLiquidity\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"_spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"min_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"ethToTokenSwapInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"ethToTokenSwapOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_sold\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"min_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"ethToTokenTransferInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"ethToTokenTransferOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_sold\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"factoryAddress\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"factory\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_sold\",\"type\":\"uint256\"}],\"name\":\"getEthToTokenInputPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"name\":\"getEthToTokenOutputPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"name\":\"getTokenToEthInputPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"}],\"name\":\"getTokenToEthOutputPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"removeLiquidity\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"setup\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"tokenAddress\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"tokenToEthSwapInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"tokenToEthSwapOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"tokenToEthTransferInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"tokenToEthTransferOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"exchange_addr\",\"type\":\"address\"}],\"name\":\"tokenToExchangeSwapInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_eth_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"exchange_addr\",\"type\":\"address\"}],\"name\":\"tokenToExchangeSwapOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"exchange_addr\",\"type\":\"address\"}],\"name\":\"tokenToExchangeTransferInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_eth_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"exchange_addr\",\"type\":\"address\"}],\"name\":\"tokenToExchangeTransferOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"tokenToTokenSwapInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_eth_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"tokenToTokenSwapOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"tokenToTokenTransferInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_eth_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"tokenToTokenTransferOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_from\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"_to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":490,"y":140,"wires":[["6c36deea.49271"]]},{"id":"6c36deea.49271","type":"json","z":"7780ff54.b10e1","name":"","property":"payload","action":"obj","pretty":false,"x":710,"y":140,"wires":[["ea48ab09.669438"]]},{"id":"ea48ab09.669438","type":"change","z":"7780ff54.b10e1","name":"Abi Uniswap: Exchange","rules":[{"t":"set","p":"abi_exchange_uniswap","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":140,"wires":[[]]},{"id":"ae205a51.0eb908","type":"comment","z":"35db65f2.4e408a","name":"Update airtable keys in this table config. (DO NOT DELETE, JUST UPDATE)","info":"","x":380,"y":140,"wires":[]},{"id":"e0a68b49.bc0988","type":"node-airtable","z":"35db65f2.4e408a","name":"Airtable Config","auth":"7ecc84ea.f9cb2c","table":"user","tableType":"str","action":"list","filter":"","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"","x":200,"y":200,"wires":[[],[]]},{"id":"d8598b2d.e6a108","type":"chatbot-telegram-receive","z":"35db65f2.4e408a","bot":"24145e37.52cb02","botProduction":"","x":430,"y":200,"wires":[[]]},{"id":"8b908367.53ae1","type":"inject","z":"35db65f2.4e408a","name":"Aragon voting app abi","topic":"","payload":"{\"environments\":{\"default\":{\"registry\":\"0x5f6f7e8cc7346a11ca2def8f827b7a0b612c56a1\",\"appName\":\"voting.aragonpm.eth\",\"network\":\"rpc\"},\"rinkeby\":{\"registry\":\"0x98Df287B6C145399Aaa709692c8D308357bC085D\",\"appName\":\"voting.aragonpm.eth\",\"network\":\"rinkeby\"},\"staging\":{\"registry\":\"0xfe03625ea880a8cba336f9b5ad6e15b0a3b5a939\",\"appName\":\"voting.aragonpm.eth\",\"network\":\"rinkeby\"},\"mainnet\":{\"registry\":\"0x314159265dd8dbb310642f98f50c066173c1259b\",\"appName\":\"voting.aragonpm.eth\",\"network\":\"mainnet\"},\"ropsten\":{\"registry\":\"0x6afe2cacee211ea9179992f89dc61ff25c61e923\",\"appName\":\"voting.aragonpm.eth\",\"network\":\"ropsten\"},\"rinkeby-old\":{\"registry\":\"0xfbae32d1cde62858bc45f51efc8cc4fa1415447e\",\"appName\":\"voting.aragonpm.eth\",\"network\":\"rinkeby\"}},\"roles\":[{\"name\":\"Create new votes\",\"id\":\"CREATE_VOTES_ROLE\",\"params\":[],\"bytes\":\"0xe7dcd7275292e064d090fbc5f3bd7995be23b502c1fed5cd94cfddbbdcd32bbc\"},{\"name\":\"Modify support\",\"id\":\"MODIFY_SUPPORT_ROLE\",\"params\":[\"New support\",\"Current support\"],\"bytes\":\"0xda3972983e62bdf826c4b807c4c9c2b8a941e1f83dfa76d53d6aeac11e1be650\"},{\"name\":\"Modify quorum\",\"id\":\"MODIFY_QUORUM_ROLE\",\"params\":[\"New quorum\",\"Current quorum\"],\"bytes\":\"0xad15e7261800b4bb73f1b69d3864565ffb1fd00cb93cf14fe48da8f1f2149f39\"}],\"path\":\"contracts/Voting.sol\",\"appName\":\"voting.aragonpm.eth\",\"env\":{\"registry\":\"0x98Df287B6C145399Aaa709692c8D308357bC085D\",\"appName\":\"voting.aragonpm.eth\",\"network\":\"rinkeby\"},\"appId\":\"0x9fa3927f639745e587912d4b0fea7ef9013bf93fb907d29faeab57417ba6e1d4\",\"abi\":[{\"constant\":true,\"inputs\":[],\"name\":\"hasInitialized\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_script\",\"type\":\"bytes\"}],\"name\":\"getEVMScriptExecutor\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getRecoveryVault\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"MODIFY_QUORUM_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"MODIFY_SUPPORT_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"token\",\"type\":\"address\"}],\"name\":\"allowRecoverability\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"appId\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getInitializationBlock\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"transferToVault\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_sender\",\"type\":\"address\"},{\"name\":\"_role\",\"type\":\"bytes32\"},{\"name\":\"_params\",\"type\":\"uint256[]\"}],\"name\":\"canPerform\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getEVMScriptRegistry\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"voteTime\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"CREATE_VOTES_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"kernel\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"minAcceptQuorumPct\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"isPetrified\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"votesLength\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"supportRequiredPct\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"token\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"PCT_BASE\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"voteId\",\"type\":\"uint256\"},{\"indexed\":true,\"name\":\"creator\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"metadata\",\"type\":\"string\"}],\"name\":\"StartVote\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"voteId\",\"type\":\"uint256\"},{\"indexed\":true,\"name\":\"voter\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"supports\",\"type\":\"bool\"},{\"indexed\":false,\"name\":\"stake\",\"type\":\"uint256\"}],\"name\":\"CastVote\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"voteId\",\"type\":\"uint256\"}],\"name\":\"ExecuteVote\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"supportRequiredPct\",\"type\":\"uint64\"}],\"name\":\"ChangeSupportRequired\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"minAcceptQuorumPct\",\"type\":\"uint64\"}],\"name\":\"ChangeMinQuorum\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"executor\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"script\",\"type\":\"bytes\"},{\"indexed\":false,\"name\":\"input\",\"type\":\"bytes\"},{\"indexed\":false,\"name\":\"returnData\",\"type\":\"bytes\"}],\"name\":\"ScriptResult\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"vault\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"token\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"RecoverToVault\",\"type\":\"event\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_supportRequiredPct\",\"type\":\"uint64\"},{\"name\":\"_minAcceptQuorumPct\",\"type\":\"uint64\"},{\"name\":\"_voteTime\",\"type\":\"uint64\"}],\"name\":\"initialize\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_supportRequiredPct\",\"type\":\"uint64\"}],\"name\":\"changeSupportRequiredPct\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_minAcceptQuorumPct\",\"type\":\"uint64\"}],\"name\":\"changeMinAcceptQuorumPct\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_executionScript\",\"type\":\"bytes\"},{\"name\":\"_metadata\",\"type\":\"string\"}],\"name\":\"newVote\",\"outputs\":[{\"name\":\"voteId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_executionScript\",\"type\":\"bytes\"},{\"name\":\"_metadata\",\"type\":\"string\"},{\"name\":\"_castVote\",\"type\":\"bool\"},{\"name\":\"_executesIfDecided\",\"type\":\"bool\"}],\"name\":\"newVote\",\"outputs\":[{\"name\":\"voteId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_voteId\",\"type\":\"uint256\"},{\"name\":\"_supports\",\"type\":\"bool\"},{\"name\":\"_executesIfDecided\",\"type\":\"bool\"}],\"name\":\"vote\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_voteId\",\"type\":\"uint256\"}],\"name\":\"executeVote\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"isForwarder\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_evmScript\",\"type\":\"bytes\"}],\"name\":\"forward\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_sender\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"bytes\"}],\"name\":\"canForward\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_voteId\",\"type\":\"uint256\"}],\"name\":\"canExecute\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_voteId\",\"type\":\"uint256\"},{\"name\":\"_voter\",\"type\":\"address\"}],\"name\":\"canVote\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_voteId\",\"type\":\"uint256\"}],\"name\":\"getVote\",\"outputs\":[{\"name\":\"open\",\"type\":\"bool\"},{\"name\":\"executed\",\"type\":\"bool\"},{\"name\":\"startDate\",\"type\":\"uint64\"},{\"name\":\"snapshotBlock\",\"type\":\"uint64\"},{\"name\":\"supportRequired\",\"type\":\"uint64\"},{\"name\":\"minAcceptQuorum\",\"type\":\"uint64\"},{\"name\":\"yea\",\"type\":\"uint256\"},{\"name\":\"nay\",\"type\":\"uint256\"},{\"name\":\"votingPower\",\"type\":\"uint256\"},{\"name\":\"script\",\"type\":\"bytes\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_voteId\",\"type\":\"uint256\"},{\"name\":\"_voter\",\"type\":\"address\"}],\"name\":\"getVoterState\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"}],\"functions\":[{\"sig\":\"initialize(address,uint64,uint64,uint64)\",\"roles\":[],\"notice\":\"Initialize Voting app with `_token.symbol(): string` for governance, minimum support of `@formatPct(_supportRequiredPct)`%, minimum acceptance quorum of `@formatPct(_minAcceptQuorumPct)`%, and a voting duration of `@transformTime(_voteTime)`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_supportRequiredPct\",\"type\":\"uint64\"},{\"name\":\"_minAcceptQuorumPct\",\"type\":\"uint64\"},{\"name\":\"_voteTime\",\"type\":\"uint64\"}],\"name\":\"initialize\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"changeSupportRequiredPct(uint64)\",\"roles\":[\"MODIFY_SUPPORT_ROLE\"],\"notice\":\"Change required support to `@formatPct(_supportRequiredPct)`%\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_supportRequiredPct\",\"type\":\"uint64\"}],\"name\":\"changeSupportRequiredPct\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"changeMinAcceptQuorumPct(uint64)\",\"roles\":[\"MODIFY_QUORUM_ROLE\"],\"notice\":\"Change minimum acceptance quorum to `@formatPct(_minAcceptQuorumPct)`%\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_minAcceptQuorumPct\",\"type\":\"uint64\"}],\"name\":\"changeMinAcceptQuorumPct\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"newVote(bytes,string)\",\"roles\":[\"CREATE_VOTES_ROLE\"],\"notice\":\"Create a new vote about \\\"`_metadata`\\\"\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_executionScript\",\"type\":\"bytes\"},{\"name\":\"_metadata\",\"type\":\"string\"}],\"name\":\"newVote\",\"outputs\":[{\"name\":\"voteId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"newVote(bytes,string,bool,bool)\",\"roles\":[\"CREATE_VOTES_ROLE\"],\"notice\":\"Create a new vote about \\\"`_metadata`\\\"\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_executionScript\",\"type\":\"bytes\"},{\"name\":\"_metadata\",\"type\":\"string\"},{\"name\":\"_castVote\",\"type\":\"bool\"},{\"name\":\"_executesIfDecided\",\"type\":\"bool\"}],\"name\":\"newVote\",\"outputs\":[{\"name\":\"voteId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"vote(uint256,bool,bool)\",\"roles\":[],\"notice\":\"Vote `_supports ? 'yes' : 'no'` in vote #`_voteId`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_voteId\",\"type\":\"uint256\"},{\"name\":\"_supports\",\"type\":\"bool\"},{\"name\":\"_executesIfDecided\",\"type\":\"bool\"}],\"name\":\"vote\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"executeVote(uint256)\",\"roles\":[],\"notice\":\"Execute vote #`_voteId`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_voteId\",\"type\":\"uint256\"}],\"name\":\"executeVote\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"forward(bytes)\",\"roles\":[],\"notice\":\"Creates a vote to execute the desired action, and casts a support vote if possible\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_evmScript\",\"type\":\"bytes\"}],\"name\":\"forward\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}}],\"deprecatedFunctions\":{}}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"0.2","x":240,"y":880,"wires":[["3deb0a1.2b439f6"]]},{"id":"3deb0a1.2b439f6","type":"json","z":"35db65f2.4e408a","name":"","property":"payload.data","action":"obj","pretty":false,"x":450,"y":880,"wires":[["667517dd.104b58"]]},{"id":"667517dd.104b58","type":"change","z":"35db65f2.4e408a","name":"abi aragon app voting","rules":[{"t":"set","p":"abi_aragon_app_voting","pt":"global","to":"payload.abi","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":880,"wires":[[]]},{"id":"499c6a59.266364","type":"inject","z":"35db65f2.4e408a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":210,"y":340,"wires":[["8fd204f.1f972f8"]]},{"id":"8fd204f.1f972f8","type":"change","z":"35db65f2.4e408a","name":"","rules":[{"t":"set","p":"maintenance","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":340,"wires":[[]]},{"id":"6c0a525b.6a679c","type":"inject","z":"35db65f2.4e408a","name":"Set Bot Token","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":220,"y":280,"wires":[["998125fb.5349e8"]]},{"id":"998125fb.5349e8","type":"change","z":"35db65f2.4e408a","name":"","rules":[{"t":"set","p":"token_telegram_bot","pt":"global","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":280,"wires":[[]]},{"id":"c814647b.76be08","type":"inject","z":"35db65f2.4e408a","name":"Set: Mainnet / Kovan","topic":"","payload":"{\"_comment\":\"change kovan/mainnet\",\"network\":\"mainnet\"}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":240,"y":500,"wires":[["52ff7e8e.f2cee"]]},{"id":"ddc9f718.db72c8","type":"change","z":"35db65f2.4e408a","name":"Kovan Const","rules":[{"t":"set","p":"network","pt":"global","to":"kovan","tot":"str"},{"t":"set","p":"wyre_link","pt":"global","to":"https://pay.testwyre.com/purchase","tot":"str"},{"t":"set","p":"wyre_account_id","pt":"global","to":"","tot":"str"},{"t":"set","p":"queryProviderEndPoint","pt":"global","to":"","tot":"str"},{"t":"set","p":"address_contract_uniswap_exchange","pt":"global","to":"0xD3E51Ef092B2845f10401a0159B2B96e8B6c3D30","tot":"str"},{"t":"set","p":"ether_scan_url","pt":"global","to":"https://kovan.etherscan.io","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":540,"wires":[["8e465a73.cf7d68"]]},{"id":"52ff7e8e.f2cee","type":"switch","z":"35db65f2.4e408a","name":"","property":"payload.network","propertyType":"msg","rules":[{"t":"eq","v":"mainnet","vt":"str"},{"t":"eq","v":"kovan","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":500,"wires":[["e5179ed4.5d89f","40014057.6161b"],["ddc9f718.db72c8","c709c012.d6704"]]},{"id":"e5179ed4.5d89f","type":"change","z":"35db65f2.4e408a","name":"Mainnet Conts","rules":[{"t":"set","p":"network","pt":"global","to":"mainnet","tot":"str"},{"t":"set","p":"queryProviderEndPoint","pt":"global","to":"","tot":"str"},{"t":"set","p":"wyre_account_id","pt":"global","to":"","tot":"str"},{"t":"set","p":"wyre_link","pt":"global","to":"https://pay.sendwyre.com/purchase","tot":"str"},{"t":"set","p":"ether_scan_url","pt":"global","to":"https://etherscan.io","tot":"str"},{"t":"set","p":"address_c19_voting_app","pt":"global","to":"0x2176bae817d519aa6e509e05e6619d14c9101ee7","tot":"str"},{"t":"set","p":"address_contract_uniswap_exchange","pt":"global","to":"0xc0a47dFe034B400B47bDaD5FecDa2621de6c4d95","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":460,"wires":[["8e465a73.cf7d68"]]},{"id":"8e465a73.cf7d68","type":"change","z":"35db65f2.4e408a","name":"Common Consts","rules":[{"t":"set","p":"wyre_default_amount","pt":"global","to":"0","tot":"num"},{"t":"set","p":"min_eth","pt":"global","to":"0.0","tot":"num"},{"t":"set","p":"SDK_ACTION_SET_AUTH_KEY","pt":"global","to":"SDK_ACTION_SET_AUTH_KEY","tot":"str"},{"t":"set","p":"SDK_ACTION_EXECUTE_TRX","pt":"global","to":"SDK_ACTION_EXECUTE_TRX","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":500,"wires":[["7218cbea.adf764"]]},{"id":"40014057.6161b","type":"debug","z":"35db65f2.4e408a","name":"FLOW: Mainnet","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":700,"y":420,"wires":[]},{"id":"c709c012.d6704","type":"debug","z":"35db65f2.4e408a","name":"FLOW: Kovan","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":700,"y":580,"wires":[]},{"id":"7218cbea.adf764","type":"change","z":"35db65f2.4e408a","name":"","rules":[{"t":"set","p":"address_c19_token","pt":"global","to":"0xaef048b75440dab69b9b6e9545d14a2150016c1c","tot":"str"},{"t":"set","p":"c19_app_url","pt":"global","to":"https://mainnet.aragon.org/#/collab","tot":"str"},{"t":"set","p":"gas_buffer","pt":"flow","to":"0.05","tot":"str"},{"t":"set","p":"min_eth_for_gas_fee","pt":"global","to":"0.005","tot":"str"},{"t":"set","p":"donation_address","pt":"global","to":"0x66b6FD8097e078CB8E0F7916efB8Be76849B3442","tot":"str"},{"t":"set","p":"group_chat_id","pt":"global","to":"","tot":"str"},{"t":"set","p":"pk_c19_token_holder","pt":"global","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1200,"y":500,"wires":[[]]},{"id":"a037262a.acb758","type":"inject","z":"35db65f2.4e408a","name":"ERC20 Abi","topic":"","payload":"[{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_spender\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"balance\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"},{\"name\":\"_spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"fallback\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"spender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"}]","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"0.2","x":210,"y":800,"wires":[["9583a08f.c2c54"]]},{"id":"9583a08f.c2c54","type":"json","z":"35db65f2.4e408a","name":"","property":"payload","action":"obj","pretty":false,"x":450,"y":800,"wires":[["cc026df3.a1e0e"]]},{"id":"cc026df3.a1e0e","type":"change","z":"35db65f2.4e408a","name":"Abi ERC20","rules":[{"t":"set","p":"abi_erc20","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":800,"wires":[[]]},{"id":"553d5a1a.2439c4","type":"inject","z":"35db65f2.4e408a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"1","x":210,"y":720,"wires":[["8be00226.33128"]]},{"id":"8be00226.33128","type":"change","z":"35db65f2.4e408a","name":"","rules":[{"t":"delete","p":"cache_balance_listener","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":720,"wires":[[]]},{"id":"39a169cf.bf1c06","type":"inject","z":"7780ff54.b10e1","name":"Aragon finance app abi","topic":"","payload":"{\"environments\":{\"default\":{\"registry\":\"0x5f6f7e8cc7346a11ca2def8f827b7a0b612c56a1\",\"appName\":\"finance.aragonpm.eth\",\"network\":\"rpc\"},\"mainnet\":{\"registry\":\"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e\",\"appName\":\"finance.aragonpm.eth\",\"network\":\"mainnet\"},\"rinkeby\":{\"registry\":\"0x98Df287B6C145399Aaa709692c8D308357bC085D\",\"appName\":\"finance.aragonpm.eth\",\"network\":\"rinkeby\"},\"ropsten\":{\"registry\":\"0x6afe2cacee211ea9179992f89dc61ff25c61e923\",\"appName\":\"finance.aragonpm.eth\",\"network\":\"ropsten\"},\"staging\":{\"registry\":\"0xfe03625ea880a8cba336f9b5ad6e15b0a3b5a939\",\"appName\":\"finance.aragonpm.eth\",\"network\":\"rinkeby\"},\"rinkeby-old\":{\"registry\":\"0xfbae32d1cde62858bc45f51efc8cc4fa1415447e\",\"appName\":\"finance.aragonpm.eth\",\"network\":\"rinkeby\"}},\"dependencies\":[{\"appName\":\"vault.aragonpm.eth\",\"version\":\"^4.0.0\",\"initParam\":\"_vault\",\"state\":\"vault\",\"requiredPermissions\":[{\"name\":\"TRANSFER_ROLE\",\"params\":\"*\"}]}],\"roles\":[{\"name\":\"Create new payments\",\"id\":\"CREATE_PAYMENTS_ROLE\",\"params\":[\"Token address\",\"Receiver address\",\"Token amount\",\"Payment interval\",\"Max repeats\",\"Initial payment time\"],\"bytes\":\"0x5de467a460382d13defdc02aacddc9c7d6605d6d4e0b8bd2f70732cae8ea17bc\"},{\"name\":\"Change period duration\",\"id\":\"CHANGE_PERIOD_ROLE\",\"params\":[\"New period duration\",\"Old period duration\"],\"bytes\":\"0xd35e458bacdd5343c2f050f574554b2f417a8ea38d6a9a65ce2225dbe8bb9a9d\"},{\"name\":\"Change budgets\",\"id\":\"CHANGE_BUDGETS_ROLE\",\"params\":[\"Token address\",\"New budget amount\",\"Old budget amount\",\"Has budget flag\"],\"bytes\":\"0xd79730e82bfef7d2f9639b9d10bf37ebb662b22ae2211502a00bdf7b2cc3a23a\"},{\"name\":\"Execute payments\",\"id\":\"EXECUTE_PAYMENTS_ROLE\",\"params\":[\"Payment ID\",\"Payment amount\"],\"bytes\":\"0x563165d3eae48bcb0a092543ca070d989169c98357e9a1b324ec5da44bab75fd\"},{\"name\":\"Manage payments\",\"id\":\"MANAGE_PAYMENTS_ROLE\",\"params\":[\"Payment ID\",\"Payment active\"],\"bytes\":\"0x30597dd103acfaef0649675953d9cb22faadab7e9d9ed57acc1c429d04b80777\"}],\"path\":\"contracts/Finance.sol\",\"appName\":\"finance.aragonpm.eth\",\"env\":{\"registry\":\"0x98Df287B6C145399Aaa709692c8D308357bC085D\",\"appName\":\"finance.aragonpm.eth\",\"network\":\"rinkeby\"},\"appId\":\"0xbf8491150dafc5dcaee5b861414dca922de09ccffa344964ae167212e8c673ae\",\"abi\":[{\"constant\":true,\"inputs\":[],\"name\":\"hasInitialized\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"CREATE_PAYMENTS_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_script\",\"type\":\"bytes\"}],\"name\":\"getEVMScriptExecutor\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getRecoveryVault\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"CHANGE_PERIOD_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"CHANGE_BUDGETS_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"periodsLength\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"appId\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getInitializationBlock\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"EXECUTE_PAYMENTS_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"transferToVault\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_sender\",\"type\":\"address\"},{\"name\":\"_role\",\"type\":\"bytes32\"},{\"name\":\"_params\",\"type\":\"uint256[]\"}],\"name\":\"canPerform\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getEVMScriptRegistry\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"kernel\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"paymentsNextIndex\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"isPetrified\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"MANAGE_PAYMENTS_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"transactionsNextIndex\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"vault\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"fallback\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"periodId\",\"type\":\"uint64\"},{\"indexed\":false,\"name\":\"periodStarts\",\"type\":\"uint64\"},{\"indexed\":false,\"name\":\"periodEnds\",\"type\":\"uint64\"}],\"name\":\"NewPeriod\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"token\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"hasBudget\",\"type\":\"bool\"}],\"name\":\"SetBudget\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"paymentId\",\"type\":\"uint256\"},{\"indexed\":true,\"name\":\"recipient\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"maxExecutions\",\"type\":\"uint64\"},{\"indexed\":false,\"name\":\"reference\",\"type\":\"string\"}],\"name\":\"NewPayment\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"transactionId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"incoming\",\"type\":\"bool\"},{\"indexed\":true,\"name\":\"entity\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"reference\",\"type\":\"string\"}],\"name\":\"NewTransaction\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"paymentId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"active\",\"type\":\"bool\"}],\"name\":\"ChangePaymentState\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"newDuration\",\"type\":\"uint64\"}],\"name\":\"ChangePeriodDuration\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"paymentId\",\"type\":\"uint256\"}],\"name\":\"PaymentFailure\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"executor\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"script\",\"type\":\"bytes\"},{\"indexed\":false,\"name\":\"input\",\"type\":\"bytes\"},{\"indexed\":false,\"name\":\"returnData\",\"type\":\"bytes\"}],\"name\":\"ScriptResult\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"vault\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"token\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"RecoverToVault\",\"type\":\"event\"},{\"constant\":false,\"inputs\":[{\"name\":\"_vault\",\"type\":\"address\"},{\"name\":\"_periodDuration\",\"type\":\"uint64\"}],\"name\":\"initialize\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_reference\",\"type\":\"string\"}],\"name\":\"deposit\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_reference\",\"type\":\"string\"}],\"name\":\"newImmediatePayment\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_initialPaymentTime\",\"type\":\"uint64\"},{\"name\":\"_interval\",\"type\":\"uint64\"},{\"name\":\"_maxExecutions\",\"type\":\"uint64\"},{\"name\":\"_reference\",\"type\":\"string\"}],\"name\":\"newScheduledPayment\",\"outputs\":[{\"name\":\"paymentId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_periodDuration\",\"type\":\"uint64\"}],\"name\":\"setPeriodDuration\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"setBudget\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"removeBudget\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_paymentId\",\"type\":\"uint256\"}],\"name\":\"executePayment\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_paymentId\",\"type\":\"uint256\"}],\"name\":\"receiverExecutePayment\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_paymentId\",\"type\":\"uint256\"},{\"name\":\"_active\",\"type\":\"bool\"}],\"name\":\"setPaymentStatus\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"recoverToVault\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_maxTransitions\",\"type\":\"uint64\"}],\"name\":\"tryTransitionAccountingPeriod\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"allowRecoverability\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_paymentId\",\"type\":\"uint256\"}],\"name\":\"getPayment\",\"outputs\":[{\"name\":\"token\",\"type\":\"address\"},{\"name\":\"receiver\",\"type\":\"address\"},{\"name\":\"amount\",\"type\":\"uint256\"},{\"name\":\"initialPaymentTime\",\"type\":\"uint64\"},{\"name\":\"interval\",\"type\":\"uint64\"},{\"name\":\"maxExecutions\",\"type\":\"uint64\"},{\"name\":\"inactive\",\"type\":\"bool\"},{\"name\":\"executions\",\"type\":\"uint64\"},{\"name\":\"createdBy\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_transactionId\",\"type\":\"uint256\"}],\"name\":\"getTransaction\",\"outputs\":[{\"name\":\"periodId\",\"type\":\"uint64\"},{\"name\":\"amount\",\"type\":\"uint256\"},{\"name\":\"paymentId\",\"type\":\"uint256\"},{\"name\":\"paymentExecutionNumber\",\"type\":\"uint64\"},{\"name\":\"token\",\"type\":\"address\"},{\"name\":\"entity\",\"type\":\"address\"},{\"name\":\"isIncoming\",\"type\":\"bool\"},{\"name\":\"date\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_periodId\",\"type\":\"uint64\"}],\"name\":\"getPeriod\",\"outputs\":[{\"name\":\"isCurrent\",\"type\":\"bool\"},{\"name\":\"startTime\",\"type\":\"uint64\"},{\"name\":\"endTime\",\"type\":\"uint64\"},{\"name\":\"firstTransactionId\",\"type\":\"uint256\"},{\"name\":\"lastTransactionId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_periodId\",\"type\":\"uint64\"},{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"getPeriodTokenStatement\",\"outputs\":[{\"name\":\"expenses\",\"type\":\"uint256\"},{\"name\":\"income\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"currentPeriodId\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getPeriodDuration\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"getBudget\",\"outputs\":[{\"name\":\"budget\",\"type\":\"uint256\"},{\"name\":\"hasBudget\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"getRemainingBudget\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"canMakePayment\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_paymentId\",\"type\":\"uint256\"}],\"name\":\"nextPaymentTime\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"}],\"functions\":[{\"sig\":\"fallback\",\"roles\":[],\"notice\":\"Deposit ETH to the Vault, to avoid locking them in this Finance app forever\"},{\"sig\":\"initialize(address,uint64)\",\"roles\":[],\"notice\":\"Initialize Finance app for Vault at `_vault` with period length of `@transformTime(_periodDuration)`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_vault\",\"type\":\"address\"},{\"name\":\"_periodDuration\",\"type\":\"uint64\"}],\"name\":\"initialize\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"deposit(address,uint256,string)\",\"roles\":[],\"notice\":\"Deposit `@tokenAmount(_token, _amount)`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_reference\",\"type\":\"string\"}],\"name\":\"deposit\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"}},{\"sig\":\"newImmediatePayment(address,address,uint256,string)\",\"roles\":[\"CREATE_PAYMENTS_ROLE\"],\"notice\":\"Create a new payment of `@tokenAmount(_token, _amount)` to `_receiver` for '`_reference`'\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_reference\",\"type\":\"string\"}],\"name\":\"newImmediatePayment\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"newScheduledPayment(address,address,uint256,uint64,uint64,uint64,string)\",\"roles\":[\"CREATE_PAYMENTS_ROLE\"],\"notice\":\"Create a new payment of `@tokenAmount(_token, _amount)` to `_receiver` for `_reference`, executing `_maxExecutions` times at intervals of `@transformTime(_interval)`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_initialPaymentTime\",\"type\":\"uint64\"},{\"name\":\"_interval\",\"type\":\"uint64\"},{\"name\":\"_maxExecutions\",\"type\":\"uint64\"},{\"name\":\"_reference\",\"type\":\"string\"}],\"name\":\"newScheduledPayment\",\"outputs\":[{\"name\":\"paymentId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"setPeriodDuration(uint64)\",\"roles\":[\"CHANGE_PERIOD_ROLE\"],\"notice\":\"Change period duration to `@transformTime(_periodDuration)`, effective for next accounting period\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_periodDuration\",\"type\":\"uint64\"}],\"name\":\"setPeriodDuration\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"setBudget(address,uint256)\",\"roles\":[\"CHANGE_BUDGETS_ROLE\"],\"notice\":\"Set budget for `_token.symbol(): string` to `@tokenAmount(_token, _amount, false)`, effective immediately\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"setBudget\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"removeBudget(address)\",\"roles\":[\"CHANGE_BUDGETS_ROLE\"],\"notice\":\"Remove spending limit for `_token.symbol(): string`, effective immediately\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"removeBudget\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"executePayment(uint256)\",\"roles\":[\"EXECUTE_PAYMENTS_ROLE\"],\"notice\":\"Execute pending payment #`_paymentId`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_paymentId\",\"type\":\"uint256\"}],\"name\":\"executePayment\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"receiverExecutePayment(uint256)\",\"roles\":[],\"notice\":\"Execute pending payment #`_paymentId`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_paymentId\",\"type\":\"uint256\"}],\"name\":\"receiverExecutePayment\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"setPaymentStatus(uint256,bool)\",\"roles\":[\"MANAGE_PAYMENTS_ROLE\"],\"notice\":\"`_active ? 'Activate' : 'Disable'` payment #`_paymentId`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_paymentId\",\"type\":\"uint256\"},{\"name\":\"_active\",\"type\":\"bool\"}],\"name\":\"setPaymentStatus\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"recoverToVault(address)\",\"roles\":[],\"notice\":\"Send tokens held in this contract to the Vault\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"recoverToVault\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"tryTransitionAccountingPeriod(uint64)\",\"roles\":[],\"notice\":\"Transition accounting period if needed\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_maxTransitions\",\"type\":\"uint64\"}],\"name\":\"tryTransitionAccountingPeriod\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}}],\"deprecatedFunctions\":{\"1.0.0\":[{\"sig\":\"newPayment(address,address,uint256,uint64,uint64,uint64,string)\",\"roles\":[\"CREATE_PAYMENTS_ROLE\"],\"notice\":\"Create a new payment of `@tokenAmount(_token, _amount)` to `_receiver``_maxRepeats > 0 ? ', executing ' + _maxRepeats + ' times at intervals of ' + @transformTime(_interval) : ''`, for '`_reference`'\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_initialPaymentTime\",\"type\":\"uint64\"},{\"name\":\"_interval\",\"type\":\"uint64\"},{\"name\":\"_maxRepeats\",\"type\":\"uint64\"},{\"name\":\"_reference\",\"type\":\"string\"}],\"name\":\"newPayment\",\"outputs\":[{\"name\":\"paymentId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}}]}}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"0.2","x":1250,"y":60,"wires":[["719c96b.aadd868"]]},{"id":"719c96b.aadd868","type":"json","z":"7780ff54.b10e1","name":"","property":"payload.data","action":"obj","pretty":false,"x":1450,"y":60,"wires":[["e64e5db2.07763"]]},{"id":"e64e5db2.07763","type":"change","z":"7780ff54.b10e1","name":"abi aragon app finance","rules":[{"t":"set","p":"abi_aragon_app_finance","pt":"global","to":"payload.abi","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1670,"y":60,"wires":[[]]},{"id":"cafa2457.908608","type":"inject","z":"7780ff54.b10e1","name":"Aragon token app abi","topic":"","payload":"{\"environments\":{\"default\":{\"registry\":\"0x5f6f7e8cc7346a11ca2def8f827b7a0b612c56a1\",\"appName\":\"token-manager.aragonpm.eth\",\"network\":\"rpc\"},\"rinkeby\":{\"registry\":\"0x98Df287B6C145399Aaa709692c8D308357bC085D\",\"appName\":\"token-manager.aragonpm.eth\",\"network\":\"rinkeby\"},\"staging\":{\"registry\":\"0xfe03625ea880a8cba336f9b5ad6e15b0a3b5a939\",\"appName\":\"token-manager.aragonpm.eth\",\"network\":\"rinkeby\"},\"mainnet\":{\"registry\":\"0x314159265dd8dbb310642f98f50c066173c1259b\",\"appName\":\"token-manager.aragonpm.eth\",\"network\":\"mainnet\"},\"ropsten\":{\"registry\":\"0x6afe2cacee211ea9179992f89dc61ff25c61e923\",\"appName\":\"token-manager.aragonpm.eth\",\"network\":\"ropsten\"},\"rinkeby-old\":{\"registry\":\"0xfbae32d1cde62858bc45f51efc8cc4fa1415447e\",\"appName\":\"token-manager.aragonpm.eth\",\"network\":\"rinkeby\"}},\"roles\":[{\"name\":\"Mint tokens\",\"id\":\"MINT_ROLE\",\"params\":[\"Receiver\",\"Token amount\"],\"bytes\":\"0x154c00819833dac601ee5ddded6fda79d9d8b506b911b3dbd54cdb95fe6c3686\"},{\"name\":\"Issue tokens\",\"id\":\"ISSUE_ROLE\",\"params\":[\"Token amount\"],\"bytes\":\"0x2406f1e99f79cea012fb88c5c36566feaeefee0f4b98d3a376b49310222b53c4\"},{\"name\":\"Assign tokens\",\"id\":\"ASSIGN_ROLE\",\"params\":[\"Receiver\",\"Token amount\"],\"bytes\":\"0xf5a08927c847d7a29dc35e105208dbde5ce951392105d712761cc5d17440e2ff\"},{\"name\":\"Revoke vesting\",\"id\":\"REVOKE_VESTINGS_ROLE\",\"params\":[\"Holder\"],\"bytes\":\"0x95ffc68daedf1eb334cfcd22ee24a5eeb5a8e58aa40679f2ad247a84140f8d6e\"},{\"name\":\"Burn tokens\",\"id\":\"BURN_ROLE\",\"params\":[\"Holder\",\"Token amount\"],\"bytes\":\"0xe97b137254058bd94f28d2f3eb79e2d34074ffb488d042e3bc958e0a57d2fa22\"}],\"path\":\"contracts/TokenManager.sol\",\"appName\":\"token-manager.aragonpm.eth\",\"env\":{\"registry\":\"0x98Df287B6C145399Aaa709692c8D308357bC085D\",\"appName\":\"token-manager.aragonpm.eth\",\"network\":\"rinkeby\"},\"appId\":\"0x6b20a3010614eeebf2138ccec99f028a61c811b3b1a3343b6ff635985c75c91f\",\"abi\":[{\"constant\":true,\"inputs\":[],\"name\":\"hasInitialized\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"MAX_VESTINGS_PER_ADDRESS\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_script\",\"type\":\"bytes\"}],\"name\":\"getEVMScriptExecutor\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getRecoveryVault\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"appId\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"ISSUE_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getInitializationBlock\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"vestingsLengths\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"transferToVault\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_sender\",\"type\":\"address\"},{\"name\":\"_role\",\"type\":\"bytes32\"},{\"name\":\"_params\",\"type\":\"uint256[]\"}],\"name\":\"canPerform\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getEVMScriptRegistry\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"ASSIGN_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"BURN_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"kernel\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"isPetrified\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"MINT_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"maxAccountTokens\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"REVOKE_VESTINGS_ROLE\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"token\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"receiver\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"vestingId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"NewVesting\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"receiver\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"vestingId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"nonVestedAmount\",\"type\":\"uint256\"}],\"name\":\"RevokeVesting\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"executor\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"script\",\"type\":\"bytes\"},{\"indexed\":false,\"name\":\"input\",\"type\":\"bytes\"},{\"indexed\":false,\"name\":\"returnData\",\"type\":\"bytes\"}],\"name\":\"ScriptResult\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"vault\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"token\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"RecoverToVault\",\"type\":\"event\"},{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_transferable\",\"type\":\"bool\"},{\"name\":\"_maxAccountTokens\",\"type\":\"uint256\"}],\"name\":\"initialize\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"issue\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"assign\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_holder\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_start\",\"type\":\"uint64\"},{\"name\":\"_cliff\",\"type\":\"uint64\"},{\"name\":\"_vested\",\"type\":\"uint64\"},{\"name\":\"_revokable\",\"type\":\"bool\"}],\"name\":\"assignVested\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_holder\",\"type\":\"address\"},{\"name\":\"_vestingId\",\"type\":\"uint256\"}],\"name\":\"revokeVesting\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"onTransfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"onApprove\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"proxyPayment\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"isForwarder\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_evmScript\",\"type\":\"bytes\"}],\"name\":\"forward\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_sender\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"bytes\"}],\"name\":\"canForward\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_recipient\",\"type\":\"address\"},{\"name\":\"_vestingId\",\"type\":\"uint256\"}],\"name\":\"getVesting\",\"outputs\":[{\"name\":\"amount\",\"type\":\"uint256\"},{\"name\":\"start\",\"type\":\"uint64\"},{\"name\":\"cliff\",\"type\":\"uint64\"},{\"name\":\"vesting\",\"type\":\"uint64\"},{\"name\":\"revokable\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_holder\",\"type\":\"address\"}],\"name\":\"spendableBalanceOf\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_holder\",\"type\":\"address\"},{\"name\":\"_time\",\"type\":\"uint256\"}],\"name\":\"transferableBalance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"}],\"name\":\"allowRecoverability\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"}],\"functions\":[{\"sig\":\"initialize(address,bool,uint256)\",\"roles\":[],\"notice\":\"Initialize Token Manager for `_token.symbol(): string`, whose tokens are `_transferable ? '' : 'not'` transferable`_maxAccountTokens > 0 ? ' and limited to a maximum of ' + @tokenAmount(_token, _maxAccountTokens, false) + ' per account' : ''`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_transferable\",\"type\":\"bool\"},{\"name\":\"_maxAccountTokens\",\"type\":\"uint256\"}],\"name\":\"initialize\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"mint(address,uint256)\",\"roles\":[\"MINT_ROLE\"],\"notice\":\"Mint `@tokenAmount(self.token(): address, _amount, false)` tokens for `_receiver`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"issue(uint256)\",\"roles\":[\"ISSUE_ROLE\"],\"notice\":\"Mint `@tokenAmount(self.token(): address, _amount, false)` tokens for the Token Manager\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"issue\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"assign(address,uint256)\",\"roles\":[\"ASSIGN_ROLE\"],\"notice\":\"Assign `@tokenAmount(self.token(): address, _amount, false)` tokens to `_receiver` from the Token Manager's holdings\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"assign\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"burn(address,uint256)\",\"roles\":[\"BURN_ROLE\"],\"notice\":\"Burn `@tokenAmount(self.token(): address, _amount, false)` tokens from `_holder`\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_holder\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"assignVested(address,uint256,uint64,uint64,uint64,bool)\",\"roles\":[\"ASSIGN_ROLE\"],\"notice\":\"Assign `@tokenAmount(self.token(): address, _amount, false)` tokens to `_receiver` from the Token Manager's holdings with a `_revokable : 'revokable' : ''` vesting starting at `@formatDate(_start)`, cliff at `@formatDate(_cliff)` (first portion of tokens transferable), and completed vesting at `@formatDate(_vested)` (all tokens transferable)\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_receiver\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_start\",\"type\":\"uint64\"},{\"name\":\"_cliff\",\"type\":\"uint64\"},{\"name\":\"_vested\",\"type\":\"uint64\"},{\"name\":\"_revokable\",\"type\":\"bool\"}],\"name\":\"assignVested\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"revokeVesting(address,uint256)\",\"roles\":[\"REVOKE_VESTINGS_ROLE\"],\"notice\":\"Revoke vesting #`_vestingId` from `_holder`, returning unvested tokens to the Token Manager\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_holder\",\"type\":\"address\"},{\"name\":\"_vestingId\",\"type\":\"uint256\"}],\"name\":\"revokeVesting\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"onTransfer(address,address,uint256)\",\"roles\":[],\"notice\":null,\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"onTransfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"onApprove(address,address,uint256)\",\"roles\":[],\"notice\":null,\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"onApprove\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}},{\"sig\":\"proxyPayment(address)\",\"roles\":[],\"notice\":null,\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"proxyPayment\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"}},{\"sig\":\"forward(bytes)\",\"roles\":[],\"notice\":\"Execute desired action as a token holder\",\"abi\":{\"constant\":false,\"inputs\":[{\"name\":\"_evmScript\",\"type\":\"bytes\"}],\"name\":\"forward\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}}],\"deprecatedFunctions\":{\"1.0.0\":[{\"sig\":\"onTransfer(address,address,uint)\",\"roles\":[],\"notice\":null},{\"sig\":\"onApprove(address,address,uint)\",\"roles\":[],\"notice\":null}]}}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"0.2","x":1240,"y":140,"wires":[["4212aade.0b77f4"]]},{"id":"4212aade.0b77f4","type":"json","z":"7780ff54.b10e1","name":"","property":"payload.data","action":"obj","pretty":false,"x":1450,"y":140,"wires":[["2a376146.951fee"]]},{"id":"2a376146.951fee","type":"change","z":"7780ff54.b10e1","name":"abi aragon app token","rules":[{"t":"set","p":"abi_aragon_app_token","pt":"global","to":"payload.abi","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1660,"y":140,"wires":[[]]},{"id":"d03bdd70.6c0a","type":"comment","z":"35db65f2.4e408a","name":"Set global constants","info":"","x":230,"y":440,"wires":[]},{"id":"feaf7209.48b6a","type":"link out","z":"c578ad64.4c8b1","name":"","links":["24179a2b.532c16"],"x":2775,"y":580,"wires":[]}]